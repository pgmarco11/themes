var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,n,d){b instanceof String&&(b=String(b));for(var a=b.length,c=0;c<a;c++){var e=b[c];if(n.call(d,e,c,b))return{i:c,v:e}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,n,d){b!=Array.prototype&&b!=Object.prototype&&(b[n]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,n,d,a){if(n){d=$jscomp.global;b=b.split(".");for(a=0;a<b.length-1;a++){var c=b[a];c in d||(d[c]={});d=d[c]}b=b[b.length-1];a=d[b];n=n(a);n!=a&&null!=n&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6-impl","es3");window.themifybuilderapp=window.themifybuilderapp||{};
(function(b){var n=b.ui.sortable.prototype._mouseStart;b.ui.sortable.prototype._mouseStart=function(a,c,b){this._trigger("beforeStart",a,this._uiHash());n.apply(this,[a,c,b])};var d=themifybuilderapp={activeModel:null,Models:{},Collections:{},Mixins:{},Views:{Modules:{},Rows:{},SubRows:{},Columns:{},Controls:{}},Forms:{},Utils:{},Instances:{Builder:{}},cache:{repeaterElements:{}}};"undefined"===typeof b.fn.themifySerializeObject&&(b.fn.themifySerializeObject=function(){var a={},c=this.serializeArray();
b.each(c,function(){if(void 0!==a[this.name]&&this.value)a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value);else if(this.value){var c=b("#themify_builder_lightbox_container #"+this.name);if(!c.length||void 0===c.data("default")||this.value!=c.data("default")||"solid"===this.value||c.hasClass("themify-checkbox"))a[this.name]=this.value}});return a});d.editing=!1;d.activeBreakPoint="desktop";d.Models.Module=Backbone.Model.extend({defaults:{elType:"module",mod_name:"",mod_settings:{}},
initialize:function(){d.Models.Registry.register(this.cid,this)},toRenderData:function(){return{slug:this.get("mod_name"),name:this.get("mod_name"),excerpt:this.getExcerpt()}},getExcerpt:function(){var a=this.get("mod_settings").content_text||this.get("mod_settings").content_box||"";return this.limitString(a,100)},limitString:function(a,c){a=this.stripHtml(a);return a.toString().length>c?a.toString().substr(0,c):a.toString()},stripHtml:function(a){var c=document.createElement("DIV");c.innerHTML=a;
return c.textContent||c.innerText||""},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)},getPreviewSettings:function(){return _.extend({cid:this.cid},this.get("mod_settings"),this.get("temp_settings"))}});d.Models.SubRow=Backbone.Model.extend({defaults:{elType:"subrow",row_order:0,gutter:"gutter-default",column_alignment:"",fullwidthvideo:"",mutevideo:"",unloopvideo:"",desktop_dir:"ltr",tablet_dir:"ltr",mobile_dir:"ltr",col_mobile:"mobile-auto",col_tablet:"tablet-auto",
cols:{},styling:{}},initialize:function(){d.Models.Registry.register(this.cid,this)},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)}});d.Models.Column=Backbone.Model.extend({defaults:{elType:"column",column_order:"",grid_class:"",component_name:"column",fullwidthvideo:"",mutevideo:"",unloopvideo:"",modules:{},styling:{}},initialize:function(){d.Models.Registry.register(this.cid,this)},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)}});
d.Models.Row=Backbone.Model.extend({defaults:{elType:"row",row_order:0,gutter:"gutter-default",column_alignment:"",desktop_dir:"ltr",tablet_dir:"ltr",mobile_dir:"ltr",col_mobile:"mobile-auto",col_tablet:"tablet-auto",fullwidthvideo:"",mutevideo:"",unloopvideo:"",cols:{},styling:{}},initialize:function(){d.Models.Registry.register(this.cid,this)},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)}});d.Collections.Rows=Backbone.Collection.extend({model:d.Models.Row});d.Models.Registry=
{items:{},register:function(a,c){this.items[a]=c},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,c){a.destroy()});this.items={};console.log("destroy registry")}};d.Models.setValue=function(a,c,b){b=b||!1;d.Models.Registry.lookup(a).set(c,{silent:b})};d.vent=_.extend({},Backbone.Events);d.Views.register_module=function(a,c){"default"!==a&&(this.Modules[a]=this.Modules["default"].extend(c))};d.Views.init_module=
function(a,c){c=c||"default";_.isUndefined(a.mod_settings)&&!_.isUndefined(themifyBuilder.modules[a.mod_name].defaults)&&(a.mod_settings=_.extend({},themifyBuilder.modules[a.mod_name].defaults));var b=a instanceof d.Models.Module?a:new d.Models.Module(a),f=new (this.get_module(c))({model:b,type:c});return{model:b,view:f}};d.Views.get_module=function(a){a=a||"default";return this.module_exists(a)?this.Modules[a]:this.Modules["default"]};d.Views.unregister_module=function(a){"default"!==a&&this.module_exists(a)&&
delete this.Modules[a]};d.Views.module_exists=function(a){return this.Modules.hasOwnProperty(a)};d.Views.register_column=function(a,c){"default"!==a&&(this.Columns[a]=this.Columns["default"].extend(c))};d.Views.init_column=function(a,c){c=c||"default";var b=a instanceof d.Models.Column?a:new d.Models.Column(a),f=new (this.get_column(c))({model:b,type:c});return{model:b,view:f}};d.Views.get_column=function(a){a=a||"default";return this.column_exists(a)?this.Columns[a]:this.Columns["default"]};d.Views.unregister_column=
function(a){"default"!==a&&this.column_exists(a)&&delete this.Columns[a]};d.Views.column_exists=function(a){return this.Columns.hasOwnProperty(a)};d.Views.register_subrow=function(a,b){"default"!==a&&(this.SubRows[a]=this.SubRows["default"].extend(b))};d.Views.init_subrow=function(a,b){b=b||"default";var c=a instanceof d.Models.SubRow?a:new d.Models.SubRow(a),f=new (this.get_subrow(b))({model:c,type:b});return{model:c,view:f}};d.Views.get_subrow=function(a){a=a||"default";return this.subrow_exists(a)?
this.SubRows[a]:this.SubRows["default"]};d.Views.unregister_subrow=function(a){"default"!==a&&this.subrow_exists(a)&&delete this.SubRows[a]};d.Views.subrow_exists=function(a){return this.SubRows.hasOwnProperty(a)};d.Views.register_row=function(a,b){"default"!==a&&(this.Rows[a]=this.Rows["default"].extend(b))};d.Views.init_row=function(a,b){b=b||"default";var c=a instanceof d.Models.Row?a:new d.Models.Row(a),f=new (this.get_row(b))({model:c,type:b});return{model:c,view:f}};d.Views.get_row=function(a){a=
a||"default";return this.row_exists(a)?this.Rows[a]:this.Rows["default"]};d.Views.unregister_row=function(a){"default"!==a&&this.row_exists(a)&&delete this.Rows[a]};d.Views.row_exists=function(a){return this.Rows.hasOwnProperty(a)};d.Views.BaseElement=Backbone.View.extend({type:"default",menuTouched:[],events:{"click .themify_builder_copy_component":"copy","click .themify_builder_paste_component":"paste","click .themify_builder_import_component":"import","click .themify_builder_export_component":"export",
"hover .module_menu":"actionMenuHover","hover .row_menu":"actionMenuHover"},initialize:function(a){_.extend(this,_.pick(a,"type"));this.listenTo(this.model,"change",this.renderInlineData);this.listenTo(this.model,"custom:change",this.modelChange);this.listenTo(this.model,"destroy",this.remove);this.listenTo(this.model,"custom:dom:update",this.domUpdate)},modelChange:function(a){this.$el.attr(_.extend({},_.result(this,"attributes")));this.render()},remove:function(){this.$el.remove()},domUpdate:function(){this.setElement(b('[data-cid="'+
this.model.cid+'"]'))},renderInlineData:function(){},copy:function(a){a.preventDefault();a.stopPropagation();console.log("copy");var c=b(a.currentTarget);var e={};a=ThemifyBuilderCommon.detectBuilderComponent(c);switch(a){case "row":case "sub-row":c=c.closest(".themify_builder_"+a.replace("-","_"));var f=c.index();f="row"===a?d.Utils._getRowSettings(c,f):d.Utils._getSubRowSettings(c,f);e=JSON.stringify(f);"row"===a&&c.find(".themify_builder_dropdown").hide();break;case "module":c=c.closest(".active_module");
e=c.data("mod-name");c=JSON.parse(c.find(".themify_module_settings").find('script[type="text/json"]').text());e=JSON.stringify({mod_name:e,mod_settings:c});break;case "column":case "sub-column":e=c.closest(".themify_builder_col"),c=c.closest("column"===a?".themify_builder_row":".themify_builder_sub_row"),f=c.index(),f="column"===a?d.Utils._getRowSettings(c,f):d.Utils._getSubRowSettings(c,f),e=e.index(),e=f.cols[e],e=JSON.stringify(e)}ThemifyBuilderCommon.Clipboard.set(a,e)},paste:function(a){a.preventDefault();
a.stopPropagation();console.log("paste");var c=b(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);var e=ThemifyBuilderCommon.Clipboard.get(a);if(!1===e)ThemifyBuilderCommon.alertWrongPaste();else if(ThemifyBuilderCommon.confirmDataPaste()){var f=this.$el.closest("[data-postid]"),e=JSON.parse(e);d.vent.trigger("dom:observer:start",f,{cid:this.model.cid,value:this.model.toJSON()});if("column"===a||"sub-column"===a){var g=c.closest(".themify_builder_col"),h=c.closest("column"===a?".themify_builder_row":
".themify_builder_sub_row"),c=g.index(),h=h.index();e.column_order=c;e.grid_class=g.prop("class").replace("themify_builder_col","");"column"===a?e.row_order=h:(e.sub_row_order=h,e.row_order=g.closest(".themify_builder_row").index(),e.col_order=g.parents(".themify_builder_col").index());e.component_name=a}this.model.setData(e);d.vent.trigger("dom:builder:change");"visual"!==this.type&&d.vent.trigger("dom:observer:end",f,{cid:this.model.cid,value:this.model.toJSON()})}},"import":function(a){a.preventDefault();
a.stopPropagation();console.log("import");var c=b(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);var e={data:{action:"tfb_imp_component_data_lightbox_options"}};d.activeModel=d.Models.Registry.lookup(c.closest("[data-cid]").data("cid"));switch(a){case "row":case "sub-row":c=c.closest(".themify_builder_"+a.replace("-","_"));ThemifyBuilderCommon.highlightRow(c);break;case "module":var f=c.closest(".themify_builder_module");b(".themify_builder_module").removeClass("current_selected_module");
f.addClass("current_selected_module");break;case "column":case "sub-column":f=c.closest(".themify_builder_col"),c=c.closest("column"===a?".themify_builder_row":".themify_builder_sub_row"),e.data.indexData={row:c.index(),col:f.index()},ThemifyBuilderCommon.highlightColumn(f)}e.data.component=a;ThemifyBuilderCommon.Lightbox.open(e,null)},"export":function(a){a.preventDefault();a.stopPropagation();console.log("export");var c=this,e="";a=b(a.currentTarget);var f=ThemifyBuilderCommon.detectBuilderComponent(a),
g={data:{action:"tfb_exp_component_data_lightbox_options"}};switch(f){case "row":case "sub-row":var h=a.closest(".themify_builder_"+f.replace("-","_")),e=function(){var a=h.index(),a="row"===f?d.Utils._getRowSettings(h,a):d.Utils._getSubRowSettings(h,a);a.component_name=f;var a=JSON.stringify(a),e=b("#tfb_exp_"+f.replace("-","_")+"_data_field");e.val(a);c._autoSelectInputField(e);e.on("click",function(){c._autoSelectInputField(e)})};break;case "module":var k=a.closest(".active_module"),e=function(){var a=
k.data("mod-name"),e=JSON.parse(k.find(".themify_module_settings").find('script[type="text/json"]').text()),a=JSON.stringify({mod_name:a,mod_settings:e,component_name:"module"}),d=b("#tfb_exp_module_data_field");d.val(a);c._autoSelectInputField(d);d.on("click",function(){c._autoSelectInputField(d)})};break;case "column":case "sub-column":var h=a.closest("column"===f?".themify_builder_row":".themify_builder_sub_row"),l=a.closest(".themify_builder_col"),e=function(){var a=h.index(),a="column"===f?d.Utils._getRowSettings(h,
a):d.Utils._getSubRowSettings(h,a),e=l.index(),a=a.cols[e];a.component_name=f;var a=JSON.stringify(a),g=b("#tfb_exp_"+f.replace("-","_")+"_data_field");g.val(a);c._autoSelectInputField(g);g.on("click",function(){c._autoSelectInputField(g)})}}g.data.component=f;ThemifyBuilderCommon.Lightbox.open(g,e)},actionMenuHover:function(a){a.stopPropagation();var c=b(a.currentTarget);if("touchend"===a.type){a=c.closest(".themify_builder_row");var e=c.closest(".themify_builder_col"),d=c.closest(".themify_builder_module"),
g="row_"+a.index();0<e.length&&(g+="_col_"+e.index());0<d.length&&(g+="_mod_"+d.index());this.menuTouched[g]?(c.find(".themify_builder_dropdown").stop(!1,!0).hide(),a.css("z-index",""),ThemifyPageBuilder.menuTouched=[]):(e=this.$el,e.find(".themify_builder_dropdown").stop(!1,!0).hide(),e.find(".themify_builder_row").css("z-index",""),c.find(".themify_builder_dropdown").stop(!1,!0).show(),a.css("z-index","998"),this.menuTouched=[],this.menuTouched[g]=!0)}else"mouseenter"===a.type?c.find(".themify_builder_dropdown").stop(!1,
!0).show():"mouseleave"===a.type&&c.find(".themify_builder_dropdown").stop(!1,!0).hide()},getBuilderID:function(){return this.$el.closest("[data-postid]").data("postid")}});d.Views.BaseElement.extend=function(a){var b=this,e=Backbone.View.extend.apply(this,arguments);e.prototype.events=_.extend({},this.prototype.events,a.events);e.prototype.initialize=function(){_.isFunction(b.prototype.initialize)&&b.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};
return e};d.Views.Modules["default"]=d.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_module module-"+this.model.get("mod_name")+" active_module","data-mod-name":this.model.get("mod_name"),"data-cid":this.model.cid}},template:wp.template("builder_module_item"),events:{dblclick:"edit","click .themify_module_options":"edit","click .js--themify_builder_module_styling":"edit","click .themify_module_delete":"delete","click .themify_module_duplicate":"duplicate"},
initialize:function(){this.listenTo(this,"edit",this.edit);this.listenTo(this.model,"custom:element:updatestate",this.removeInitialStateClass)},render:function(){this.$el.html(this.template(this.model.toRenderData()));this.renderInlineData();return this},renderInlineData:function(){this.$(".themify_module_settings").find('script[type="text/json"]').text(JSON.stringify(this.model.get("mod_settings")))},removeInitialStateClass:function(){this.$el.removeClass("tb_module_state_unsaved")},edit:function(a,
c){var e=!1;_.isNull(a)||_.isUndefined(a)?e=!0:(a.preventDefault(),this.model.set({styleClicked:b(a.currentTarget).hasClass("themify_builder_module_styling")},{silent:!0}));c=c||!1;d.activeModel=this.model;var f=this,g=this.model.get("mod_settings");b(".module_menu .themify_builder_dropdown").hide();this.highlightModuleBack(this.$el);c||d.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:d.activeModel.cid,value:{mod_settings:d.activeModel.get("mod_settings")}});var h=function(a){a.setAttribute("data-form-state",
c?"new":"edit");if("desktop"!==d.activeBreakPoint){var h=b("#themify_builder_options_styling .tfb_lb_option").map(function(){return b(this).attr("id")}).get();g=_.omit(g,h);!_.isUndefined(g["breakpoint_"+d.activeBreakPoint])&&_.isObject(g["breakpoint_"+d.activeBreakPoint])&&(g=_.extend(g,g["breakpoint_"+d.activeBreakPoint]))}"visual"===f.type&&d.liveStylingInstance.init(f.$el.children(".module"),g);var k=a.getElementsByClassName("tfb_lb_option"),q,v=!_.isEmpty(g);for(q=0;q<k.length;++q){h=b(k[q]);
var p=h.attr("id");var m=g[p];h.hasClass("themify-gradient")?d.Utils.createGradientPicker(h,m):h.hasClass("tf-radio-input-container")&&h.find(":checked").trigger("change");if(m)if(h.hasClass("select_menu_field"))isNaN(m)?h.find("option[value='"+m+"']").attr("selected","selected"):h.find("option[data-termid='"+m+"']").attr("selected","selected");else if(h.is("select"))h.val(m).trigger("change");else if(h.hasClass("themify-builder-uploader-input")){p=m;var u=b("<img/>",{src:p,width:50,height:50});p?
(h.val(p),h.parent().find(".img-placeholder").empty().html(u).parent().show()):h.parent().find(".thumb_preview").hide()}else if(h.hasClass("themify-option-query-cat")){p=h.parent();var u=p.find(".query_category_multiple"),x=m.split("|")[0];p.find("option[value='"+x+"']").attr("selected","selected");u.val(x)}else if(h.hasClass("themify_builder_row_js_wrapper")){p=0;d.cache.repeaterElements[h.attr("id")]=h.find(".tb_repeatable_field").first().clone();0<m.length&&(p=m.length-1);for(u=0;u<p;u++)h.parent().find(".add_new a").first().trigger("click");
h.find(".tb_repeatable_field").each(function(a){b(this).find(".tfb_lb_option_child").each(function(c){c=b(this);var e=c.attr("id"),f=c.hasClass("tfb_lb_wp_editor")?c.attr("name"):c.data("input-id");f||(f=e);e=m[a][""+f+""];if(c.hasClass("themify-builder-uploader-input")){var h=b("<img/>",{src:e,width:50,height:50});e?(c.val(e),c.parent().find(".img-placeholder").empty().html(h).parent().show()):c.parent().find(".thumb_preview").hide()}else if(c.hasClass("tf-radio-choice"))c.find("input[value='"+e+
"']").attr("checked","checked").trigger("change");else if(c.hasClass("themify-layout-icon"))c.find("#"+e).addClass("selected");else if(c.hasClass("themify-checkbox"))for(h in e)c.find("input[value='"+e[h]+"']").prop("checked",!0);else c.is("input, textarea, select")&&c.val(e);c.hasClass("tfb_lb_wp_editor")&&d.Views.init_control("wp_editor",{el:c});c.data("control-binding")&&c.data("control-type")&&d.Views.init_control(c.data("control-type"),{el:c,binding_type:c.data("control-binding")})})})}else if(h.hasClass("tf-radio-input-container"))h.find("input[value='"+
m+"']").attr("checked","checked").trigger("change"),p=h.find('input[name="'+p+'"]:checked').val(),h.hasClass("tf-option-checkbox-enable")&&(h.find(".tf-group-element").hide(),h.find(".tf-group-element-"+p).show());else if(h.is('input[type!="checkbox"][type!="radio"], textarea'))h.val(m).trigger("change"),!c&&h.is("textarea")&&h.hasClass("tf-thumbs-preview")&&f.getShortcodePreview(h,m);else if(h.hasClass("themify-checkbox")){var w=m,w=w.split("|");h.find(".tf-checkbox").each(function(){b(this).prop("checked",
-1!==b.inArray(b(this).val(),w))})}else h.hasClass("themify-layout-icon")?h.find("#"+m).addClass("selected"):h.html(m);else h.hasClass("themify-layout-icon")?h.children().first().addClass("selected"):h.hasClass("themify-builder-uploader-input")?h.parent().find(".thumb_preview").hide():h.hasClass("tf-radio-input-container")?(h.find('input[type="radio"]').first().prop("checked"),p=h.find('input[name="'+p+'"]:checked').val(),h.hasClass("tf-option-checkbox-enable")&&(h.find(".tf-group-element").hide(),
h.find(".tf-group-element-"+p).show())):h.hasClass("themify_builder_row_js_wrapper")?(d.cache.repeaterElements[h.attr("id")]=h.find(".tb_repeatable_field").first().clone(),h.find(".tb_repeatable_field").each(function(a){b(this).find(".tfb_lb_option_child").each(function(a){a=b(this);a.hasClass("tfb_lb_wp_editor")&&d.Views.init_control("wp_editor",{el:a});a.data("control-binding")&&a.data("control-type")&&d.Views.init_control(a.data("control-type"),{el:a,binding_type:a.data("control-binding")})})})):
h.hasClass("themify-checkbox")&&v?h.find(".tf-checkbox").each(function(){b(this).prop("checked",!1)}):h.is('input[type!="checkbox"][type!="radio"], textarea')&&v&&h.val("");h.hasClass("tfb_lb_wp_editor")&&d.Views.init_control("wp_editor",{el:h});h.hasClass("themify_builder_row_js_wrapper")&&d.Views.init_control("repeater",{el:h,binding_type:h.data("control-binding")});h.data("control-binding")&&h.data("control-type")&&"repeater"!==h.data("control-type")&&d.Views.init_control(h.data("control-type"),
{el:h,binding_type:h.data("control-binding")})}b("body").trigger("editing_module_option",[g]);b(".tf-option-checkbox-enable input:checked").trigger("change");f.model.get("styleClicked")&&b('a[href="#themify_builder_options_styling"]').length&&b('a[href="#themify_builder_options_styling"]').trigger("click");e&&"gallery"===f.model.get("mod_name")&&b(".tf-gallery-btn",a).trigger("click");d.Utils.setColorPicker(a);d.Utils.builderPlupload("normal");f.moduleOptionsBinding();b(".themify_builder_tabs").tabs();
f.applyAll_init();ThemifyBuilderCommon.fontPreview(b("#themify_builder_lightbox_container"),g);"visual"===f.type&&(ThemifyBuilderCommon.Lightbox.rememberRow(f),d.liveStylingInstance.addStyleDate(f.model.get("mod_name"),themifyBuilder.element_style_rules[f.model.get("mod_name")]),d.styleSheet.rememberRules())};ThemifyBuilderCommon.highlightRow(this.$el.closest(".themify_builder_row"));ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_module_"+this.model.get("mod_name")},
function(a){setTimeout(function(){h(a)},400)})},"delete":function(a){a.preventDefault();confirm(themifyBuilder.i18n.moduleDeleteConfirm)&&(a=this.$el.closest("[data-postid]"),d.vent.trigger("dom:observer:start",a),this.switchPlaceholdModule(this.$el),this.model.destroy(),d.vent.trigger("dom:observer:end",a),d.vent.trigger("dom:builder:change"))},duplicate:function(a){a.preventDefault();a=d.Views.init_module(this.model.toJSON(),this.type);var b=this.$el.closest("[data-postid]");d.vent.trigger("dom:observer:start",
b);a.view.render().$el.insertAfter(this.$el);"visual"!==this.type&&(d.vent.trigger("dom:builder:change"),d.vent.trigger("dom:observer:end",b));a.view.trigger("component:duplicate")}});d.Views.Columns["default"]=d.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_col module_column "+this.model.get("grid_class"),style:this.model.get("grid_width")?"width:"+this.model.get("grid_width")+"%":"","data-cid":this.model.cid,"data-fullwidthvideo":this.model.get("fullwidthvideo"),
"data-mutevideo":this.model.get("mutevideo"),"data-unloopvideo":this.model.get("unloopvideo")}},template:wp.template("builder_column_item"),events:{"click .themify_builder_option_column":"edit","click .js-column-menu-icon":"click_menu_icon","click .js-tb_empty_row_btn":"showModPanel"},initialize:function(){this.listenTo(this.model,"change:styling",this.renderInlineData);this.listenTo(this.model,"change:grid_class",this.renderAttrs)},renderAttrs:function(){this.$el.attr(_.extend({},_.result(this,"attributes")))},
render:function(){this.$el.html(this.template(this.model.toJSON()));this.renderInlineData();if(!_.isEmpty(this.model.get("modules"))){var a=document.createDocumentFragment();_.each(this.model.get("modules"),function(b,e){if(_.isNull(b))return!0;_.isObject(b.mod_settings)?b.mod_settings=d.Utils.removeEmptyFields(b.mod_settings):_.isObject(b.styling)&&(b.styling=d.Utils.removeEmptyFields(b.styling));var c=b&&_.isUndefined(b.cols)?d.Views.init_module(b,this.type):d.Views.init_subrow(b,this.type);a.appendChild(c.view.render().el)},
this);this.$el.find(".themify_module_holder").append(a)}return this},renderInlineData:function(){var a=this.model.get("styling"),b="",e="",d="";_.isObject(a)&&(b=_.isEmpty(a.background_video)||"video"!==a.background_type?"":a.background_video)&&!_.isEmpty(a.background_video_options)&&(e=-1!==a.background_video_options.indexOf("mute")?"mute":"",d=-1!==a.background_video_options.indexOf("unloop")?"unloop":"");this.$el.attr({"data-fullwidthvideo":b,"data-mutevideo":e,"data-unloopvideo":d});this.$el.children(".column-data-styling").attr("data-styling",
JSON.stringify(a))},edit:function(a){a.preventDefault();a.stopPropagation();d.activeModel=this.model;var b=this;d.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:d.activeModel.cid,value:{styling:d.activeModel.get("styling")}});ThemifyBuilderCommon.highlightColumn(this.$el);ThemifyBuilderCommon.highlightRow(this.$el.closest(".themify_builder_row"));ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_column"},function(){d.Mixins.Builder.editComponent("column",
b)})},click_menu_icon:function(a){a.preventDefault()},showModPanel:function(a){a.preventDefault();d.toolbar._show_module_panel()}});d.Views.SubRows["default"]=d.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_sub_row module_subrow clearfix  module_subrow_"+this.model.cid+" tb_element_cid_"+this.model.cid,"data-column-alignment":this.model.get("column_alignment"),"data-desktop_dir":this.model.get("desktop_dir"),"data-tablet_dir":this.model.get("tablet_dir"),
"data-mobile_dir":this.model.get("mobile_dir"),"data-mobile":this.model.get("col_mobile"),"data-tablet":this.model.get("col_tablet"),"data-gutter":this.model.get("gutter"),"data-cid":this.model.cid,"data-fullwidthvideo":this.model.get("fullwidthvideo"),"data-mutevideo":this.model.get("mutevideo"),"data-unloopvideo":this.model.get("unloopvideo")}},template:wp.template("builder_sub_row_item"),events:{"click .themify_builder_style_subrow":"edit","click .sub_row_delete":"delete","click .sub_row_duplicate":"duplicate"},
initialize:function(){this.listenTo(this.model,"change:styling",this.renderInlineData)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.renderInlineData();if(!_.isUndefined(this.model.get("cols"))){var a=document.createDocumentFragment();_.each(this.model.get("cols"),function(b,c){b.component_name="sub-column";_.isObject(b.styling)&&(b.styling=d.Utils.removeEmptyFields(b.styling));var e=d.Views.init_column(b,this.type);a.appendChild(e.view.render().el)},this);this.$el.find(".themify_builder_sub_row_content").append(a)}var c=
{},e=this.model.get("col_tablet"),f=this.model.get("col_mobile"),g=this.$el.find(".themify_builder_sub_row_content");c.desktop=this.model.get("desktop_dir");c.tablet=this.model.get("tablet_dir");c.mobile=this.model.get("mobile_dir");e||(e="tablet-auto");f||(f="mobile-auto");c.desktop||(c.desktop="ltr");c.tablet||(c.tablet="ltr");c.mobile||(c.mobile="ltr");var h=this.$el;b.each(c,function(a,b){"ltr"!==b&&h.find(".themify_builder_grid_"+a+" .themify_builder_column_direction").first().find("li").removeClass("selected").children(".column-dir-"+
b).parent().addClass("selected")});"visual"===d.mode?g.removeClass("desktop-col-direction-ltr desktop-col-direction-rtl tablet-col-direction-ltr tablet-col-direction-rtl mobile-col-direction-ltr mobile-col-direction-rtl").addClass("tfb_grid_classes desktop-col-direction-"+c.desktop+" tablet-col-direction-"+c.tablet+" mobile-col-direction-"+c.mobile):g.addClass("direction-"+c.desktop);var c=this.$el.find(".themify_builder_grid_mobile ."+f).first(),k=this.$el.find(".themify_builder_grid_tablet ."+e).first(),
l=parseInt(c.data("col")),r=parseInt(k.data("col"));c.closest("li").addClass("selected");k.closest("li").addClass("selected");if(2===l||3===l)f+=" mobile-"+(2===l?"2col":"3col");if(2===r||3===r)e+=" tablet-"+(2===r?"2col":"3col");g.addClass(this.model.get("gutter")+" "+f+" "+e);return this},renderInlineData:function(){var a=this.model.get("styling"),b="",e="",d="";_.isObject(a)&&(b=_.isEmpty(a.background_video)||"video"!==a.background_type?"":a.background_video)&&!_.isEmpty(a.background_video_options)&&
(e=-1!==a.background_video_options.indexOf("mute")?"mute":"",d=-1!==a.background_video_options.indexOf("unloop")?"unloop":"");this.$el.attr({"data-fullwidthvideo":b,"data-mutevideo":e,"data-unloopvideo":d});this.$el.find(".gutter_select").val(this.model.get("gutter"));this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]').parent().addClass("selected").siblings().removeClass("selected");this.$el.children(".subrow-data-styling").attr("data-styling",JSON.stringify(a));"col_align_top"!==
this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]')&&setTimeout(function(){this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]').trigger("click")}.bind(this),400)},edit:function(a){a.preventDefault();a.stopPropagation();d.activeModel=this.model;var b=this;d.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:d.activeModel.cid,value:{styling:d.activeModel.get("styling")}});ThemifyBuilderCommon.highlightSubRow(this.$el);ThemifyBuilderCommon.highlightColumn(this.$el.closest(".themify_builder_column"));
ThemifyBuilderCommon.highlightRow(this.$el.closest(".themify_builder_row"));ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_subrow"},function(){d.Mixins.Builder.editComponent("sub-row",b)})},"delete":function(a){a.preventDefault();a.stopPropagation();confirm(themifyBuilder.i18n.subRowDeleteConfirm)&&(a=this.$el.closest("[data-postid]"),d.vent.trigger("dom:observer:start",a),this.model.destroy(),d.vent.trigger("dom:observer:end",a),d.vent.trigger("dom:builder:change"))},
duplicate:function(a){a.preventDefault();a.stopPropagation();a=d.Views.init_subrow(d.Utils._getSubRowSettings(this.$el,this.$el.index()),this.type);var b=this.$el.closest("[data-postid]");d.vent.trigger("dom:observer:start",b);a.view.render().$el.insertAfter(this.$el);a.view.trigger("component:duplicate");"visual"!==this.type&&(d.vent.trigger("dom:builder:change"),d.vent.trigger("dom:observer:end",b))}});d.Views.Rows["default"]=d.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_row module_row clearfix module_row_"+
this.model.cid+" tb_element_cid_"+this.model.cid,"data-column-alignment":this.model.get("column_alignment"),"data-desktop_dir":this.model.get("desktop_dir"),"data-tablet_dir":this.model.get("tablet_dir"),"data-mobile_dir":this.model.get("mobile_dir"),"data-mobile":this.model.get("col_mobile"),"data-tablet":this.model.get("col_tablet"),"data-gutter":this.model.get("gutter"),"data-cid":this.model.cid,"data-fullwidthvideo":this.model.get("fullwidthvideo"),"data-mutevideo":this.model.get("mutevideo"),
"data-unloopvideo":this.model.get("unloopvideo")}},template:wp.template("builder_row_item"),events:{"click .themify_builder_option_row":"edit","click .themify_builder_style_row":"edit","click .themify_builder_delete_row":"delete","click .themify_builder_duplicate_row":"duplicate","click .themify_builder_grid_list li a":"_gridMenuClicked","click .themify_builder_grid_list_wrapper .grid_tabs li a":"_switchGridTabs","click .themify_builder_column_alignment li a":"_columnAlignmentMenuClicked","click .themify_builder_column_direction li a":"_columnDirectionMenuClicked",
"change .gutter_select":"_gutterChange","click .toggle_row":"toggleRow","click .themify_builder_toggle_row":"toggleRow"},initialize:function(){this.listenTo(this.model,"change:styling",this.renderInlineData)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.renderInlineData();if(_.isEmpty(this.model.get("cols")))d.Utils._addNewColumn({newclass:"col-full",component:"column",type:this.type},this.$el.find(".themify_builder_row_content"));else{var a=document.createDocumentFragment();
_.each(this.model.get("cols"),function(b,c){b.component_name="column";_.isObject(b.styling)&&(b.styling=d.Utils.removeEmptyFields(b.styling));var e=d.Views.init_column(b,this.type);a.appendChild(e.view.render().el)},this);this.$el.find(".themify_builder_row_content").append(a)}setTimeout(function(){d.Mixins.Builder._selectedGridMenu(this.$el)}.bind(this),100);var c={},e=this.model.get("col_tablet"),f=this.model.get("col_mobile"),g=this.$el.find(".themify_builder_row_content");c.desktop=this.model.get("desktop_dir");
c.tablet=this.model.get("tablet_dir");c.mobile=this.model.get("mobile_dir");e||(e="tablet-auto");f||(f="mobile-auto");c.desktop||(c.desktop="ltr");c.tablet||(c.tablet="ltr");c.mobile||(c.mobile="ltr");var h=this.$el;b.each(c,function(a,b){"ltr"!==b&&h.find(".themify_builder_grid_"+a+" .themify_builder_column_direction").first().find("li").removeClass("selected").children(".column-dir-"+b).parent().addClass("selected")});"visual"===d.mode?g.removeClass("desktop-col-direction-ltr desktop-col-direction-rtl tablet-col-direction-ltr tablet-col-direction-rtl mobile-col-direction-ltr mobile-col-direction-rtl").addClass("tfb_grid_classes desktop-col-direction-"+
c.desktop+" tablet-col-direction-"+c.tablet+" mobile-col-direction-"+c.mobile):g.addClass("direction-"+c.desktop);var c=this.$el.find(".themify_builder_grid_mobile ."+f).first(),k=this.$el.find(".themify_builder_grid_tablet ."+e).first(),l=parseInt(c.data("col")),r=parseInt(k.data("col"));c.closest("li").addClass("selected");k.closest("li").addClass("selected");if(2===l||3===l)f+=" mobile-"+(2===l?"2col":"3col");if(2===r||3===r)e+=" tablet-"+(2===r?"2col":"3col");g.addClass(this.model.get("gutter")+
" "+f+" "+e);return this},defaultRowValues:function(){var a=this,c=b(this.template(this.model.toJSON()));"col_align_top"!==a.model.get("column_alignment")&&c.find(".themify_builder_column_alignment > li").removeClass("selected").each(function(){b(this).find("a").data("alignment")===a.model.get("column_alignment")&&b(this).addClass("selected")});"gutter-default"!==a.model.get("gutter")&&c.find(".gutter_select option").each(function(){b(this).val()===a.model.get("gutter")&&(b(this).attr("selected",
""),setTimeout(function(){c.find(".gutter_select").trigger("change")}))});return c[0]},renderInlineData:function(){var a="",b="",e="",d="",g=this.model.get("styling");this.$el.find(".row-data-styling").attr("data-styling",JSON.stringify(g));_.isObject(g)&&(a=_.isEmpty(g.row_anchor)?"":"#"+g.row_anchor,(b=_.isEmpty(g.background_video)||"video"!==g.background_type?"":g.background_video)&&!_.isEmpty(g.background_video_options)&&(e=-1!==g.background_video_options.indexOf("mute")?"mute":"",d=-1!==g.background_video_options.indexOf("unloop")?
"unloop":""));this.$el.attr({"data-fullwidthvideo":b,"data-mutevideo":e,"data-unloopvideo":d});this.$el.find(".row-anchor-name").first().text(a);this.$el.find(".gutter_select").val(this.model.get("gutter"));this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]').parent().addClass("selected").siblings().removeClass("selected")},edit:function(a){a.preventDefault();a.stopPropagation();this.model.set({styleClicked:b(a.currentTarget).hasClass("themify_builder_style_row")},{silent:!0});
d.activeModel=this.model;var c=this;d.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:d.activeModel.cid,value:{styling:d.activeModel.get("styling")}});ThemifyBuilderCommon.highlightRow(this.$el);ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_row"},function(){d.Mixins.Builder.editComponent("row",c)})},"delete":function(a){a.preventDefault();a.stopPropagation();confirm(themifyBuilder.i18n.rowDeleteConfirm)&&(a=this.$el.closest("[data-postid]"),
d.vent.trigger("dom:observer:start",a),this.model.destroy(),d.vent.trigger("dom:observer:end",a),d.vent.trigger("dom:builder:change"))},duplicate:function(a){a.preventDefault();a.stopPropagation();a=d.Views.init_row(d.Utils._getRowSettings(this.$el,this.$el.index()),this.type);var b=this.$el.closest("[data-postid]");d.vent.trigger("dom:observer:start",b);a.view.render().$el.insertAfter(this.$el);a.view.trigger("component:duplicate");"visual"!==this.type&&(d.vent.trigger("dom:builder:change"),d.vent.trigger("dom:observer:end",
b))},_switchGridTabs:function(a){a.preventDefault();a.stopPropagation();var c=b(a.currentTarget),e=c.attr("href").replace("#","");if("module"===c.data("handle"))return!1;if("visual"!==d.mode){if(c.closest("li").hasClass("selected"))return!1;c.closest("ul").children("li.selected").removeClass("selected");c.closest("li").addClass("selected");c.closest(".grid_menu").find(".themify_builder_grid_tab").hide();c.closest(".grid_menu").find(".themify_builder_grid_tab.themify_builder_grid_"+e).show().find(".themify_builder_column_direction li.selected a").trigger("click")}else"tablet"===
e&&(e+="-landscape"),b(".js--themify_builder_breakpoint_switcher.breakpoint-"+e).trigger("click"),setTimeout(function(){var a=c.closest(".themify_builder_row").data("cid"),g=c.closest(".themify_builder_content").data("postid"),a="desktop"===e?b(".module_row_"+a,"#themify_builder_content-"+g):d.Frontend.responsiveFrame.$el.find("#themify_builder_content-"+g+" .module_row_"+a);b("html,body").animate({scrollTop:a.offset().top-b("#headerwrap.fixed-header").outerHeight(!0)-30},"fast")},1200)},_gridMenuClicked:function(a){a.preventDefault();
a.stopPropagation();var c=this,e=b(a.currentTarget),f=e.data("grid"),g=e.data("handle"),h=!1,k=e.closest("[data-postid]"),l=e.data("type"),r="desktop"===l;d.vent.trigger("dom:observer:start",k);e.closest(".themify_builder_grid_list").find(".selected").removeClass("selected");e.closest("li").addClass("selected");if("module"===g){if("-full"!==f[0]){var q=d.Views.init_subrow({cols:[{grid_class:"col-full"}]},this.type);var v=e.closest(".active_module"),p=v.clone();p.insertAfter(v);v.find(".grid_menu").remove();
var m=q.view.render().$el.find(".themify_module_holder").append(v).end().insertAfter(p).find("."+e.attr("class").replace(" ",".")).closest("li").addClass("selected").end().end().find(".themify_builder_sub_row_content");m.closest(".themify_builder_sub_row").find(".themify_builder_grid_"+l+":first .themify_builder_grid_list ."+l+f.join("-")).closest("li").addClass("selected");q=m.closest(".themify_builder_sub_row").find(".themify_builder_grid_tablet .themify_builder_grid_list li li,.themify_builder_grid_mobile .themify_builder_grid_list li li");
d.Utils.hideResponsiveCols(q,e.data("col"));p.remove()}}else{h="sub_row"===g;var u=e.closest(".themify_builder_"+g);m=u.find(".themify_builder_"+g+"_content")}"visual"!==d.mode||r||a.isTrigger||"module"===g||(p=m.closest(".themify_builder_content").data("postid"),b("#themify_builder_content-"+p).find(".module_"+g.replace("_","")+"_"+u.data("cid")+" .themify_builder_grid_"+l+":first .themify_builder_grid_list ."+l+f.join("-")).trigger("click"));if("module"!==g){var x=e.closest(".themify_builder_grid_list_wrapper");
var w=r?e.data("col"):x.find(".themify_builder_grid_desktop li.selected a").data("col");if(w){if(!r){k=parseInt(e.data("col"));var t=l+f.join("-");if("visual"===d.mode){a=t;if(2===k||3===k)a+=" "+l+"-"+(2===k?"2col":"3col");m.removeClass(l+"-2col "+l+"-3col tmp-mobile-auto "+u.attr("data-"+l)).addClass(a)}"tablet"===g&&d.Frontend.responsiveFrame.$el.find(".mobile-auto").removeClass("mobile-auto").addClass("tmp-mobile-auto");u.attr("data-"+l,t).data(l,t);return!1}a.isTrigger||(q=x.find(".themify_builder_grid_tablet .themify_builder_grid_list li li,.themify_builder_grid_mobile .themify_builder_grid_list li li"),
d.Utils.hideResponsiveCols(q,w),"visual"===d.mode&&(d.Utils.removeGridClass(m,"col-count"),m.removeClass("count-odd count-even").addClass("col-count-"+w+" count-"+(0===w%2?"even":"odd")),b.each(["tablet","mobile"],function(a,b){var c=x.find(".themify_builder_grid_"+b+" .themify_builder_grid_list li.selected"),e=0<c.length?x.find(".themify_builder_grid_"+b+" .themify_builder_grid_list li li").eq(w-1):!1;if(e&&"none"===c.css("display")&&"none"!==e.css("display")){c.removeClass("selected");e.addClass("selected");
e=e.children("a");c=parseInt(e.data("col"));e=e.data("grid");e=t=b+e.join("-");if(2===c||3===c)e+=" "+b+"-"+(2===c?"2col":"3col");m.removeClass(b+"-2col "+b+"-3col "+u.attr("data-"+b)).addClass(e);u.attr("data-"+b,t).data(b,t)}})))}}b.each(f,function(a,b){0<m.children(".themify_builder_col").eq(a).length?m.children(".themify_builder_col").eq(a).removeClass(d.Utils.clearClass).addClass("module_column col"+b):d.Utils._addNewColumn({newclass:(h?"sub_column module_column ":"")+"col"+b,component:h?"sub-column":
"column",type:c.type},m)});f.length<m.children().length&&m.children(".themify_builder_col").eq(f.length-1).nextAll().each(function(){var a=b(this).find(".themify_module_holder").first();a.find(".empty_holder_text").remove();a.children().appendTo(b(this).prev().find(".themify_module_holder").first());b(this).remove()});g=m.children();g.removeClass("first last");"visual"===d.mode&&m.hasClass(l+"-col-direction-rtl")||"visual"!==d.mode&&m.hasClass("direction-rtl")?(g.last().addClass("first"),g.first().addClass("last")):
(g.first().addClass("first"),g.last().addClass("last"));var n=!1;h&&"-full"===f[0]&&(n=m.find(".active_module"),l=m.closest(".themify_builder_row"),n.insertAfter(e.closest(".themify_builder_sub_row")),e.closest(".themify_builder_sub_row").remove(),"visual"===d.mode&&"desktop"!==d.activeBreakPoint&&d.Mixins.Builder.initGridMenu(l));setTimeout(function(){var a=h&&n?n.find(".themify_builder_grid_list"):e.closest(".themify_builder_grid_list");"-full"===f[0]?(a.find("a:first").parent().addClass("selected"),
a.nextAll(".themify_builder_column_alignment").find("a:first").trigger("click"),a.nextAll(".gutter_select").val("gutter-default").trigger("change"),a.nextAll().hide()):a.nextAll().show()},100);d.Utils.columnDrag(m,!0);d.vent.trigger("dom:observer:end",k);d.vent.trigger("dom:builder:change")},_columnAlignmentMenuClicked:function(a){a.preventDefault();a.stopPropagation();var c=b(a.currentTarget),e=c.data("handle"),f=c.data("alignment");if("module"!==e&&(a.isTrigger||!c.closest("li").hasClass("selected"))){if(a.which){var g=
c.closest("[data-postid]");d.vent.trigger("dom:observer:start",g)}c.closest(".themify_builder_column_alignment").find(".selected").removeClass("selected");c.closest("li").addClass("selected");c=c.closest(".themify_builder_"+e);c.data("column-alignment",f);"visual"===this.type&&c.removeClass(themifyBuilder.columnAlignmentClass).addClass(f);a.which&&d.vent.trigger("dom:observer:end",g)}},_columnDirectionMenuClicked:function(a){a.preventDefault();a.stopPropagation();var c=b(a.currentTarget);var e=c.data("handle"),
f=c.data("dir"),g=c.data("type"),h="module"===e?!1:c.closest(".themify_builder_"+e).find(".themify_builder_"+e+"_content");if("module"!==e&&(a.isTrigger||f!==h.data(g+"-dir")&&!c.closest("li").hasClass("selected"))){if(a.which){var k=c.closest("[data-postid]");d.vent.trigger("dom:observer:start",k)}var l="";c.closest(".themify_builder_column_direction").find(".selected").removeClass("selected");c.closest("li").addClass("selected");h.removeClass("tablet-direction-selected mobile-direction-selected desktop-direction-selected").addClass(g+
"-direction-selected").closest("[data-cid]").data(g+"_dir",f);"visual"===d.mode?(h.removeClass(g+"-col-direction-ltr "+g+"-col-direction-rtl").addClass(g+"-col-direction-"+f),c=a.isTrigger&&"desktop"!==d.activeBreakPoint&&"desktop"===g,"desktop"===d.activeBreakPoint||a.isTrigger||(l=h.closest(".themify_builder_content").data("postid"),e="sub_row"===e?h.closest(".themify_builder_sub_row").data("cid"):h.closest(".themify_builder_row").data("cid"),b("#themify_builder_content-"+l).find('[data-cid="'+
e+'"]').find(".themify_builder_grid_"+g+":first .themify_builder_column_direction  .column-dir-"+f).trigger("click")),l="tablet_landscape"===d.activeBreakPoint?"tablet":d.activeBreakPoint):(h.removeClass("direction-rtl direction-ltr").addClass("direction-"+f),c=!0);if(c||g===l)g=h.children(".themify_builder_col"),h=g.first(),c=g.last(),g.removeClass("first last"),"rtl"===f?(h.addClass("last"),c.addClass("first")):(h.addClass("first"),c.addClass("last"));a.which&&d.vent.trigger("dom:observer:end",
k)}},_gutterChange:function(a){a.stopPropagation();a=b(a.currentTarget);var c=a.data("handle");if("module"!==c){var e=a.closest(".themify_builder_"+c);d.Utils.columnDrag(e.find(".themify_builder_"+c+"_content"),!1,e.data("gutter"),a.val());e.data("gutter",a.val()).find(".themify_builder_"+c+"_content").removeClass(themifyBuilder.gutterClass).addClass(a.val())}},toggleRow:function(a){a.preventDefault();a.stopPropagation();b(a.currentTarget).parents(".themify_builder_row").toggleClass("collapsed").find(".themify_builder_row_content").slideToggle()}});
d.Views.Builder=Backbone.View.extend({type:"default",events:{"click .tb-import-layout-button":"importLayoutButton"},initialize:function(a){_.extend(this,_.pick(a,"type"));d.vent.on("dom:builder:change",this.tempEvents.bind(this))},render:function(){var a=document.createDocumentFragment();this.collection.each(function(b){_.isObject(b.attributes)&&_.isObject(b.attributes.styling)&&(b.attributes.styling=d.Utils.removeEmptyFields(b.attributes.styling));b=d.Views.init_row(b,this.type);a.appendChild(b.view.render().el)},
this);this.el.appendChild(a);this.addElementClasses();d.Utils.columnDrag(null,!1);d.vent.trigger("dom:builder:change");this.insertLayoutButton();return this},addElementClasses:function(){var a=this.$el.data("postid");this.$el.find(".themify_builder_row").addClass("themify_builder_"+a+"_row");this.$el.find(".themify_builder_col:not(.sub_column)").addClass("module_column tb_"+a+"_column")},tempEvents:function(){this.deleteEmptyModule();this.newRowAvailable();this.moduleEvents()},insertLayoutButton:function(){2>
this.$(".module_row ").length&&this.$el.append('<a href="#" class="tb-import-layout-button">'+themifyBuilderCommon.text_import_layout_button+"</a>")},importLayoutButton:function(a){a.preventDefault();d.Views.Toolbar.prototype.load_layout(a)}});d.Mixins.Common={_autoSelectInputField:function(a){a.trigger("focus").trigger("select")},highlightModuleBack:function(a){b(".active_module").removeClass("current_selected_module");a.addClass("current_selected_module")},moduleOptionsBinding:function(){var a=
function(a,c,d){if(c){var e=!1;""==d&&"undefined"!==typeof c.empty?e=c.empty:""!=d&&"undefined"!==typeof c[d]?e=c[d]:""!=d&&"undefined"!==typeof c.not_empty&&(e=c.not_empty);e&&("undefined"!==typeof e.show&&b.each(e.show,function(c,e){var d=a.closest(".themify_builder_row_content");d.length?d.find("."+e).removeClass("conditional-input").children().show():b("."+e).removeClass("conditional-input").children().show()}),"undefined"!==typeof e.hide&&b.each(e.hide,function(c,e){var d=a.closest(".themify_builder_row_content");
0<d.length?d.find("."+e).addClass("conditional-input").children().hide():b("."+e).addClass("conditional-input").children().hide()}))}},c=b("#tfb_module_settings");b("body").on("change","input[data-binding], textarea[data-binding], select[data-binding]",c,function(){a(b(this),b(this).data("binding"),b(this).val())});b("input[data-binding], textarea[data-binding], select[data-binding]",c).trigger("change");b(c).on("click",".tfb_lb_option.themify-layout-icon[data-binding] a",function(){a(b(this),b(this).parent().data("binding"),
b(this).attr("id"))});b(".tfb_lb_option.themify-layout-icon a.selected",c).trigger("click")},applyAll_init:function(){var a=this;b(".style_apply_all").each(function(){var c=b(this).val(),e=b(this).closest(".themify_builder_field").prevUntil("h4"),f=e.last(),g=f.find('input[type="text"]').not(".colordisplay"),h=f.find("select"),k="border"===c?'[name="border_top_color"], [name="border_top_width"], [name="border_top_style"], [name="border_right_color"], [name="border_right_width"], [name="border_right_style"], [name="border_bottom_color"], [name="border_bottom_width"], [name="border_bottom_style"], [name="border_left_color"], [name="border_left_width"], [name="border_left_style"]':
'[name="'+c+'_top"], [name="'+c+'_right"], [name="'+c+'_bottom"], [name="'+c+'_left"]',l=!0,r=function(h){if(e.first().next(".themify_builder_field").find(".style_apply_all").is(":checked")){var g=b(this).val(),k=!1,l=b(this).is("select");e.not(":last").each(function(){l?(k=b(this).find("select option").prop("selected",!1).filter('[value="'+g+'"]'),k.prop("selected",!0),"border"!==c&&k.trigger("change")):(k=b(this).find('input[type="text"].tfb_lb_option'),k.val(g),"border"!==c&&k.trigger("keyup"))});
k&&"border"===c&&"visual"===a.type&&(d.liveStylingInstance.setApplyBorder(l?k.closest("select").prop("name"):k.prop("name"),g,l?"style":"width"),l?f.find('input[type="text"].colordisplay').trigger("blur"):(h=f.find(".colordisplay, .style_border").map(function(){return this.value||null}).get(),_.isEmpty(h)?d.liveStylingInstance.setApplyBorder(f.find("select").prop("name"),"","style"):f.find("select").trigger("change")))}};b(this).is(":checked")?(e.not(":last").hide(),f.children(".themify_builder_input").css("color",
"#FFF")):(e.find(k).each(function(){if(b(this).val()&&"solid"!==b(this).val())return l=!1}),l&&(b(this).prop("checked",!0),e.not(":last").hide(),f.children(".themify_builder_input").css("color","#FFF")));g.on("keyup",_.debounce(r,300));h.on("change",r)})},switchPlaceholdModule:function(a){a=a.parents(".themify_module_holder");1===a.find(".themify_builder_module").length&&a.find(".empty_holder_text").show()},getShortcodePreview:function(a,c){b.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tfb_load_shortcode_preview",
tfb_load_nonce:themifyBuilder.tfb_load_nonce,shortcode:c},success:function(b){b&&a.after(b)}})},rowOptionBuilder:function(){b(".themify_builder_row_opt_builder_wrap").sortable({items:".themify_builder_row",handle:".themify_builder_row_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",start:function(a,c){"undefined"!==typeof tinyMCE&&b("#tfb_row_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id"),c=tinymce.get(a).getContent();b(this).data("content",
c);tinyMCE.execCommand("mceRemoveEditor",!1,a)})},stop:function(a,c){"undefined"!==typeof tinyMCE&&b("#tfb_row_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id");tinyMCE.execCommand("mceAddEditor",!1,a);tinymce.get(a).setContent(b(this).data("content"))})},sort:function(a,c){var e=c.item.height();b(".themify_builder_row_opt_builder_wrap .themify_builder_ui_state_highlight").height(e)}})}};d.Mixins.Builder={builderContainer:document.querySelector(".themify_builder_editor_wrapper"),
moduleEvents:function(){var a=this;this.$el.find(".row_menu .themify_builder_dropdown, .module_menu .themify_builder_dropdown").hide();this.$el.find(".themify_module_holder").each(function(){0<b(this).find(".active_module").length?b(this).find(".empty_holder_text").hide():b(this).find(".empty_holder_text").show()});var c=!1,e={placeholder:"themify_builder_ui_state_highlight",items:".active_module, .themify_builder_sub_row",connectWith:".themify_module_holder",cursor:"move",revert:100,tolerance:"pointer",
cursorAt:{top:20,left:110},beforeStart:function(e,f){d.vent.trigger("dom:observer:start",f.item.closest("[data-postid]"));"visual"===a.type&&(f.item.css("height",40),c=!0,b(this).sortable("refresh"))},sort:function(c,e){b(".themify_module_holder .themify_builder_ui_state_highlight").height(35);"visual"===a.type?(b(".themify_module_holder .themify_builder_sortable_helper").height(40).width(220),b("#themify_builder_module_panel").hasClass("slide_builder_module_state_down")||(b("#themify_builder_module_panel").addClass("slide_builder_module_state_down"),
d.Frontend.slidePanelOpen=!1,b("#themify_builder_module_panel").find(".slide_builder_module_panel_wrapper").slideUp())):e.item.css("width",220)},receive:function(c,e){a.placeHoldDragger();b(this).parent().find(".empty_holder_text").hide()},stop:function(e,f){if(f.item.hasClass("active_module")||f.item.hasClass("themify_builder_sub_row"))c&&(f.item.css("height",""),c=!1),f.item.hasClass("themify_builder_sub_row")&&f.item.parents(".themify_builder_sub_row").length&&(f.item.find(".active_module").clone().insertAfter(f.item),
f.item.remove()),0<b(".themify_module_holder .themify_builder_sortable_helper").length&&b(".themify_module_holder .themify_builder_sortable_helper").remove(),d.vent.trigger("dom:builder:change"),d.vent.trigger("dom:observer:end",f.item.closest("[data-postid]"));else{var h=d.Views.init_module({mod_name:f.item.data("module-slug")},a.type),g=h.view.render().$el;b(this).parent().find(".empty_holder_text").hide();f.item.replaceWith(g);h.view.trigger("edit",null,!0);h.view.trigger("custom:preview:init");
h.view.$el.addClass("tb_module_state_unsaved")}0<b(".themify_module_holder .themify_builder_ui_state_highlight").length&&b(".themify_module_holder .themify_builder_ui_state_highlight").remove()}};"visual"===a.type&&(e.helper=function(){return b('<div class="themify_builder_sortable_helper"/>')},e.handle=".themify_builder_module_front_overlay, .themify_builder_sub_row_top",e.create=function(a,c){b("body").css("overflow-x","inherit")});this.$(".themify_module_holder").sortable(e);var f=!1,e={items:".themify_builder_row",
handle:".themify_builder_row_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",containment:"parent",tolerance:"pointer",cursor:"move",beforeStart:function(c,e){d.vent.trigger("dom:observer:start",e.item.closest("[data-postid]"));"visual"!==a.type||e.item.hasClass("collapsed")||(e.item.addClass("collapsed").find(".themify_builder_row_content").first().hide(),f=!0,b(this).sortable("refresh"))},sort:function(c,e){if("visual"===a.type)b(".themify_builder_ui_state_highlight").height(35),b(".themify_builder_sortable_helper").height(35);
else{var d=e.item.height();b(".themify_builder_row_panel .themify_builder_ui_state_highlight").height(d)}},update:function(b,c){"visual"===a.type&&f&&(c.item.removeClass("collapsed").find(".themify_builder_row_content").first().show(),f=!1);d.vent.trigger("dom:observer:end",c.item.closest("[data-postid]"))},create:function(c,e){"visual"===a.type&&b("body").css("overflow-x","inherit")}};"visual"===a.type&&(e.helper=function(){return b('<div class="themify_builder_sortable_helper"/>')},e.stop=function(a,
b){f&&(b.item.removeClass("collapsed").find(".themify_builder_row_content").first().show(),f=!1)});this.$el.sortable(e);this.$el.find(".themify_builder_row_content, .themify_builder_sub_row_content").each(function(){var a=b(this);1<a.children(".themify_builder_col").length&&a.sortable({items:"> .themify_builder_col",handle:"> .themify_builder_column_action .themify_builder_column_dragger",axis:"x",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursorAt:{top:20,left:20},beforeStart:function(a,
b){d.vent.trigger("dom:observer:start",b.item.closest("[data-postid]"))},sort:function(a,c){b(".themify_builder_ui_state_highlight").width(c.item.width())},stop:function(b,c){a.children().removeClass("first last");var e="tablet_landscape"===d.activeBreakPoint?"tablet":d.activeBreakPoint;"visual"===d.mode&&a.hasClass(e+"-col-direction-rtl")||"visual"!==d.mode&&a.hasClass("direction-rtl")?(a.children().last().addClass("first"),a.children().first().addClass("last")):(a.children().first().addClass("first"),
a.children().last().addClass("last"));d.Utils.columnDrag(a,!1);d.vent.trigger("dom:observer:end",c.item.closest("[data-postid]"))}})});this.initGridMenu()},initGridMenu:function(a){a||(a=this.$el);var c=wp.template("builder_grid_menu")({});a.find(".themify_builder_row_content").each(function(){b(this).children().each(function(){b(this).find(".themify_module_holder").first().children(".active_module").each(function(){if(0===b(this).find(".grid_menu").length){var a=b(c);a.find(".grid-layout--full").closest("li").addClass("selected");
b(this).append(a)}})})})},editComponent:function(a,c){var e="row"===a,f=c.model.get("styling")||{},g=e?"#tfb_row_settings":"sub-row"===a?"#tfb_subrow_settings":"#tfb_column_settings";if("desktop"!==d.activeBreakPoint){var h=b((e?"#themify_builder_row_fields_styling":g)+" .tfb_lb_option").map(function(){return b(this).attr("id")}).get();var k=f.background_type;f=_.omit(f,h);!_.isUndefined(f["breakpoint_"+d.activeBreakPoint])&&_.isObject(f["breakpoint_"+d.activeBreakPoint])&&(f=_.extend(f,f["breakpoint_"+
d.activeBreakPoint]))}"visual"===c.type&&d.liveStylingInstance.init(c.$el,f);f&&("undefined"!==typeof f.background_slider&&c.getShortcodePreview(b("#background_slider"),f.background_slider),b.each(f,function(a,c){b(g).find("#"+a).val(c)}),b(g).find('.tf-radio-input-container [type="radio"]').each(function(){var a=b(this).prop("name");"undefined"!==typeof f[a]&&b(this).val()===f[a]&&b(this).prop("checked",!0)}));b(g).find(".themify-builder-uploader-input").each(function(){var a=b(this).val(),c=b("<img/>",
{src:a,width:50,height:50});a?b(this).parent().find(".img-placeholder").empty().html(c):b(this).parent().find(".thumb_preview").hide()});b(".themify-gradient").each(function(){var a=b(this).prop("name");f=b.extend({$key:""},f);d.Utils.createGradientPicker(b(this),f[a])});e&&b(g).find(".themify_builder_row_js_wrapper").each(function(){var a=b(this),c=a.attr("id"),e=f?f[c]:!1;d.cache.repeaterElements[c]=a.find(".tb_repeatable_field").first().clone();if(e){c=0;0<e.length&&(c=e.length-1);for(var h=0;h<
c;h++)a.parent().find(".add_new a").first().trigger("click");a.find(".tb_repeatable_field").each(function(a){b(this).find(".tfb_lb_option_child").each(function(c){c=b(this);var d=c.hasClass("tfb_lb_wp_editor")?c.attr("name"):c.data("input-id");d||(d=c.attr("id"));d=e[a][""+d+""];if(c.hasClass("themify-builder-uploader-input")){var f=b("<img/>",{src:d,width:50,height:50});d?(c.val(d),c.parent().find(".img-placeholder").empty().html(f).parent().show()):c.parent().find(".thumb_preview").hide()}else c.is("input, textarea, select")&&
c.val(d)})})}d.Views.init_control("repeater",{el:a})});d.Utils.setColorPicker();""!==b("#background_video").val()&&0===b("#background_type input:checked").length?b("#background_type_video").trigger("click"):0===b("#background_type input:checked").length&&b("#background_type_image").trigger("click");b(".tf-option-checkbox-enable input:checked").trigger("click");d.Utils.builderPlupload("normal");b(".themify-checkbox").each(function(){var a=b(this).attr("id");b(this).find(".tf-checkbox").prop("checked",
!1);f&&f[a]&&(f[a]="string"===typeof f[a]?[f[a]]:f[a],b.each(f[a],function(a,c){b('.tf-checkbox[value="'+c+'"]').prop("checked",!0)}))});b("body").trigger("editing_"+a.replace("-","_")+"_option",[f]);e&&c.rowOptionBuilder();c.applyAll_init();ThemifyBuilderCommon.fontPreview(b("#themify_builder_lightbox_container"),f);e&&c.model.get("styleClicked")&&b('a[href="#themify_builder_row_fields_styling"]').trigger("click");"desktop"!==d.activeBreakPoint&&(b(".responsive-na").hide(),-1!==b.inArray(k,["video",
"slider"])&&b.each(["background_repeat","background_position","background_image"],function(a,c){if("video"===k&&"background_image"===c)return!0;b("#"+c).closest(".themify_builder_field").hide()}));"visual"===c.type&&(ThemifyBuilderCommon.Lightbox.rememberRow(c),d.liveStylingInstance.addStyleDate(c.model.get("elType"),themifyBuilder.element_style_rules[c.model.get("elType")]),d.styleSheet.rememberRules())},placeHoldDragger:function(){this.$el.find(".themify_module_holder").each(function(){0===b(this).find(".active_module").length&&
b(this).find(".empty_holder_text").show()})},newRowAvailable:function(){var a=this.$el.children(".themify_builder_row");a.each(function(){if(!(0<b(this).find(".active_module").length)){var c=!0,e=null;b(this).find(".column-data-styling").each(function(){c&&(e=b.parseJSON(b(this).attr("data-styling")),"array"===typeof e&&0<e.length||!b.isEmptyObject(e))&&(c=!1)});e=b.parseJSON(b(this).find(".row-data-styling").attr("data-styling"));if(c&&("string"===typeof e||b.isEmptyObject(e))&&1<a.length&&b(this).index()+
1<a.length){var f=b(this).find("[data-cid]").map(function(){return b(this).data("cid")}).get();f.push(b(this).data("cid"));console.log(f,"removeCids");_.each(f,function(a,b){var c=d.Models.Registry.lookup(a);c&&c.destroy()})}}});(0<this.$el.children(".themify_builder_row").last().find(".active_module").length||0===this.$el.children(".themify_builder_row").length)&&d.Views.init_row({cols:[{grid_class:"col-full first last"}]},this.type).view.render().$el.appendTo(this.$el)},_selectedGridMenu:function(a){a=
a||document;b(".grid_menu",a).each(function(){var a=b(this).data("handle"),e=[];if("module"!==a){a=b(this).closest(".themify_builder_"+a).find(".themify_builder_"+a+"_content");a.children().each(function(){e.push(d.Utils._getColClass(b(this).prop("class").split(" ")))});var f=b(this).find(".themify_builder_grid_desktop .grid-layout-"+e.join("-")),g=f.data("col");f.closest("li").addClass("selected");var h=b(this).find(".themify_builder_grid_desktop .themify_builder_grid_list"),k=f.data("grid");k&&
"-full"===k[0]?(h.nextAll(".themify_builder_column_alignment").find("a:first").trigger("click"),h.nextAll(".gutter_select").val("gutter-default").trigger("change"),h.nextAll().hide()):h.nextAll().show();h=b(this).find(".themify_builder_grid_tablet .themify_builder_grid_list li li,.themify_builder_grid_mobile .themify_builder_grid_list li li");d.Utils.hideResponsiveCols(h,g);f.data("col")&&a.addClass("col-count-"+g+" count-"+(0===g%2?"even":"odd"))}})},makeEqual:function(a,c){a.each(function(){var a=
0;b(this).find(c).children().each(function(){var c=b(this).find(".themify_module_holder").first();c.css("min-height","");c.height()>a&&(a=c.height())});b(this).find(c).children().each(function(){b(this).find(".themify_module_holder").first().css("min-height",a+"px")})})},deleteEmptyModule:function(){this.$el.find(".active_module.tb_module_state_unsaved").each(function(){var a=d.Models.Registry.lookup(b(this).data("cid"));a&&a.destroy()})},toJSON:function(){var a={};this.$el.children(".themify_builder_row").each(function(c){a[c]=
d.Utils._getRowSettings(b(this),c)});return a}};d.Forms={Validators:{},bindEvents:function(){var a=b("body");_.isNull(d.Utils.tfb_hidden_editor_object)&&(d.Utils.tfb_hidden_editor_object=tinyMCEPreInit.mceInit.tfb_lb_hidden_editor);if(b.fn.ThemifyGradient)a.on("change",".tf-image-gradient-field .tf-radio-input-container input",function(){var a=b(this).val(),e=b(this).closest(".tf-image-gradient-field"),d=e.find(".themify-gradient-field").hide(),e=e.find(".themify-image-field").hide();"image"===a&&
e.show();"gradient"===a&&d.show()});a.on("click","#tfb_row_settings .add_new a",this.rowOptAddRow).on("click","#tfb_module_settings .add_new a",this.moduleOptAddRow).on("click",".js-builder-restore-revision-btn",ThemifyBuilderCommon.restoreRevision).on("click",".js-builder-delete-revision-btn",ThemifyBuilderCommon.deleteRevision).on("click","#builder_submit_import_form",this.builderImportSubmit).on("click",".layout_preview img",this.templateSelected).on("click","#builder_submit_layout_form",this.saveAsLayout).on("click",
".style_apply_all",this.applyAll_events).on("click","#builder_submit_import_component_form",this.importRowModBuilderFormSave);this.moduleActions()},moduleSave:function(a){a.preventDefault();if(d.Forms.isValidate(b("#tfb_module_settings"))){var c={},e=d.activeModel.get("mod_settings");a=b(".current_selected_module").closest("[data-postid]");b("#tfb_module_settings .tfb_lb_option").each(function(){var a=b(this).attr("id");if(b(this).hasClass("tfb_lb_wp_editor")&&!b(this).hasClass("builder-field"))var e=
"undefined"!==typeof tinyMCE?!1===tinyMCE.get(a).hidden?tinyMCE.get(a).getContent():switchEditors.wpautop(tinymce.DOM.get(a).value):b(this).val();else if(b(this).hasClass("themify-checkbox")){var f=[];b(this).find(".tf-checkbox:checked").each(function(a){f.push(b(this).val())});e=0<f.length?f.join("|"):null}else if(b(this).hasClass("themify-layout-icon"))e=0<b(this).find(".selected").length?b(this).find(".selected").attr("id"):b(this).children().first().attr("id");else if(b(this).hasClass("themify-option-query-cat")){var g=
b(this).parent();e=g.find(".query_category_single");g=g.find(".query_category_multiple");e=g.val()?g.val()+"|multiple":e.val()+"|single"}else b(this).hasClass("themify_builder_row_js_wrapper")?e=d.Utils.getRepeaterValues(b(this)):b(this).hasClass("tf-radio-input-container")?e=b(this).find('input[name="'+a+'"]:checked').val():b(this).hasClass("module-widget-form-container")?e=b(this).find(":input").themifySerializeObject():b(this).is("select, input, textarea")&&(e=b(this).val());e&&(e!=b(this).data("default")||
b(this).hasClass("themify-checkbox")||"solid"===e)&&(c[a]=e)});if("desktop"!==d.activeBreakPoint){var f=b("#themify_builder_options_styling .tfb_lb_option").map(function(){return b(this).attr("id")}).get(),g=_.pick(c,f),c=_.omit(c,f),c=_.extend(c,_.pick(e,f));c["breakpoint_"+d.activeBreakPoint]=g;_.each(_.omit(themifyBuilder.breakpoints,d.activeBreakPoint),function(a,b){_.isUndefined(e["breakpoint_"+b])||(c["breakpoint_"+b]=e["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,function(a,b){_.isUndefined(e["breakpoint_"+
b])||(c["breakpoint_"+b]=e["breakpoint_"+b])});d.activeModel.set({mod_settings:{}},{silent:!0});d.activeModel.set({mod_settings:d.Utils.removeEmptyFields(c)});d.activeModel.trigger("custom:element:updatestate");ThemifyBuilderCommon.Lightbox.close();d.vent.trigger("dom:observer:end",a,{cid:d.activeModel.cid,value:{mod_settings:d.activeModel.get("mod_settings")}});0<b(".mce-inline-toolbar-grp:visible").length&&b(".mce-inline-toolbar-grp:visible").hide();0<b(".tb-import-layout-button").length&&b(".tb-import-layout-button").remove()}},
rowSaving:function(a){a.preventDefault();var c=b("#tfb_row_settings").themifySerializeObject(),e=d.activeModel.get("styling")||{};a={};var f=b(".current_selected_row").closest("[data-postid]");b("#tfb_row_settings").find(".themify_builder_row_js_wrapper").each(function(){var a=b(this).attr("id"),e=d.Utils.getRepeaterValues(b(this));e&&(c[a]=e)});if("desktop"!==d.activeBreakPoint){var g=b("#themify_builder_row_fields_styling .tfb_lb_option").map(function(){return b(this).attr("id")}).get();a=_.pick(c,
g);c=_.omit(c,g);c=_.extend(c,_.pick(e,g));c["breakpoint_"+d.activeBreakPoint]=a;_.each(_.omit(themifyBuilder.breakpoints,d.activeBreakPoint),function(a,b){_.isUndefined(e["breakpoint_"+b])||(c["breakpoint_"+b]=e["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,function(a,b){_.isUndefined(e["breakpoint_"+b])||(c["breakpoint_"+b]=e["breakpoint_"+b])});d.activeModel.set({styling:{}},{silent:!0});d.activeModel.set("styling",d.Utils.removeEmptyFields(c));ThemifyBuilderCommon.Lightbox.close();
d.vent.trigger("dom:observer:end",f,{cid:d.activeModel.cid,value:{styling:d.activeModel.get("styling")}})},subRowSaving:function(a){a.preventDefault();var c=d.activeModel.get("styling")||{},e=b("#tfb_subrow_settings").themifySerializeObject();a={};var f=b(".current_selected_sub_row").closest("[data-postid]");if("desktop"!==d.activeBreakPoint){var g=b("#tfb_subrow_settings .tfb_lb_option").map(function(){return b(this).attr("id")}).get();a=e;e=_.omit(e,g);e=_.extend(e,_.pick(c,g));e["breakpoint_"+
d.activeBreakPoint]=a;_.each(_.omit(themifyBuilder.breakpoints,d.activeBreakPoint),function(a,b){_.isUndefined(c["breakpoint_"+b])||(e["breakpoint_"+b]=c["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,function(a,b){_.isUndefined(c["breakpoint_"+b])||(e["breakpoint_"+b]=c["breakpoint_"+b])});d.activeModel.set({styling:{}},{silent:!0});d.activeModel.set("styling",d.Utils.removeEmptyFields(e));ThemifyBuilderCommon.Lightbox.close();d.vent.trigger("dom:observer:end",f,{cid:d.activeModel.cid,
value:{styling:d.activeModel.get("styling")}})},columnSaving:function(a){a.preventDefault();var c=d.activeModel.get("styling")||{},e=b("#tfb_column_settings").themifySerializeObject();a={};var f=b(".current_selected_column").closest("[data-postid]");if("desktop"!==d.activeBreakPoint){var g=b("#tfb_column_settings .tfb_lb_option").map(function(){return b(this).attr("id")}).get();a=e;e=_.omit(e,g);e=_.extend(e,_.pick(c,g));e["breakpoint_"+d.activeBreakPoint]=a;_.each(_.omit(themifyBuilder.breakpoints,
d.activeBreakPoint),function(a,b){_.isUndefined(c["breakpoint_"+b])||(e["breakpoint_"+b]=c["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,function(a,b){_.isUndefined(c["breakpoint_"+b])||(e["breakpoint_"+b]=c["breakpoint_"+b])});d.activeModel.set("styling",d.Utils.removeEmptyFields(e));ThemifyBuilderCommon.Lightbox.close();d.vent.trigger("dom:observer:end",f,{cid:d.activeModel.cid,value:{styling:d.activeModel.get("styling")}})},rowOptAddRow:function(a){var c=b(this).parent().prev(),e=
d.cache.repeaterElements[c.attr("id")].clone(),f=b(".themify_builder_row_js_wrapper").find(".themify_builder_row:visible").length+1,g=f+Math.floor(9*Math.random());e.removeClass("collapsed").find(".themify_builder_row_content").show();e.find(".themify-builder-radio-dnd").each(function(a){var c=b(this).attr("name");b(this).attr({name:c+"_"+f,id:c+"_"+f+"_"+a}).not(":checked").prop("checked",!1).next("label").attr("for",c+"_"+f+"_"+a)});e.find(".themify-layout-icon a").removeClass("selected");e.find(".thumb_preview").each(function(){b(this).find(".img-placeholder").html("").parent().hide()});
e.find('input[type="text"], textarea').each(function(){b(this).val("")});e.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var c=b(this).parents(".wp-editor-wrap").parent(),e=b(this).prop("id"),d=b(this).prop("name"),f=e+"_"+ThemifyBuilderCommon.randNumber(),e=c.html().replace(new RegExp(e,"g"),f),f=a.which?"newEditor":"";c.html(e).find(".tfb_lb_wp_editor").prop("name",d).addClass(f)});e.find(".themify-builder-plupload-upload-uic").each(function(a){b(this).attr("id","pluploader_"+f+
g+a+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find('input[type="button"]').attr("id","pluploader_"+f+g+a+"themify-builder-plupload-browse-button")});e.find(".builderColorSelectInput").each(function(){var a=b(this),c=a.clone().val(""),e=a.closest(".themify_builder_field");a.prev().minicolors("destroy").removeAttr("maxlength");e.find(".colordisplay").wrap('<div class="themify_builder_input" />').before('<span class="builderColorSelect"><span></span></span>').after(c);d.Utils.setColorPicker(e)});
b(e).appendTo(c).show();a.which&&(b("#tfb_row_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child.newEditor").each(function(a){d.Views.init_control("wp_editor",{el:b(this)});b(this).removeClass("newEditor")}),d.Utils.builderPlupload("new_elemn"));a.preventDefault()},moduleOptAddRow:function(a){var c=b(this).parent().prev(),e=d.cache.repeaterElements[c.attr("id")].clone(),f=b(".themify_builder_row_js_wrapper").find(".themify_builder_row:visible").length+1,g=f+Math.floor(9*Math.random());e.removeClass("collapsed").find(".themify_builder_row_content").show();
e.find(".themify-builder-radio-dnd").each(function(a){var c=b(this).attr("name");b(this).prop({name:c+"_"+f,id:c+"_"+f+"_"+a,checked:!1}).next("label").attr("for",c+"_"+f+"_"+a);if(b(this).is("[data-checked]")){var e=b(this);b(this).prop("checked",!0);setTimeout(function(){e.trigger("change")},100)}});e.find("[data-binding]").each(function(){var a=b(this).data("binding");try{var c="."+a.empty.hide.join(", .");e.find(c).children().hide()}catch(l){}});e.find(".themify-layout-icon a").removeClass("selected");
e.find(".thumb_preview").each(function(){b(this).find(".img-placeholder").html("").parent().hide()});e.find("input[type=text], textarea").each(function(){b(this).val("")});e.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var c=b(this).parents(".wp-editor-wrap").parent(),e=b(this).prop("id"),d=b(this).prop("name"),f=e+"_"+ThemifyBuilderCommon.randNumber(),e=c.html().replace(new RegExp(e,"g"),f),f=a.which?"newEditor":"";c.html(e).find(".tfb_lb_wp_editor").prop("name",d).addClass(f)});
e.find(".themify-builder-plupload-upload-uic").each(function(a){b(this).attr("id","pluploader_"+f+g+a+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find("input[type=button]").attr("id","pluploader_"+f+g+a+"themify-builder-plupload-browse-button")});e.find(".builderColorSelectInput").each(function(){var a=b(this),c=a.clone().val(""),e=a.closest(".themify_builder_field");a.prev().minicolors("destroy").removeAttr("maxlength");e.find(".colordisplay").wrap('<div class="themify_builder_input" />').before('<span class="builderColorSelect"><span></span></span>').after(c);
d.Utils.setColorPicker(e)});e.find(".tfb_lb_option_child").each(function(){b(this).data("control-binding")&&b(this).data("control-type")&&d.Views.init_control(b(this).data("control-type"),{el:b(this),binding_type:b(this).data("control-binding")})});b(e).appendTo(c).show();a.which&&(b("#tfb_module_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child.newEditor").each(function(a){d.Views.init_control("wp_editor",{el:b(this)});b(this).removeClass("newEditor")}),d.Utils.builderPlupload("new_elemn"));
a.preventDefault()},builderImportSubmit:function(a){a.preventDefault();var c=b(this);ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.dialog_import_page_post,function(a){b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"builder_import_submit",nonce:themifyBuilder.tfb_load_nonce,data:c.closest("form").serialize(),importType:"no"===a?"replace":"append",importTo:themifyBuilder.post_ID},beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){ThemifyBuilderCommon.Lightbox.close();
ThemifyBuilderCommon.showLoader("spinhide");window.location.reload()}})},{buttons:{no:{label:"Replace Existing Builder"},yes:{label:"Append Existing Builder"}}})},templateSelected:function(a){a.preventDefault();var c=b(this).closest(".layout_preview");ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirm_template_selected,function(a){var e={type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"no"===a?"tfb_set_layout":"tfb_append_layout",nonce:themifyBuilder.tfb_load_nonce,
layout_slug:c.data("slug"),current_builder_id:themifyBuilder.post_ID,layout_group:c.data("group")},success:function(a){ThemifyBuilderCommon.Lightbox.close();if("success"==a.status)if("visual"===d.mode)window.location.hash="#builder_active",window.location.reload();else{var c=wp.autosave.getPostData();d.isPostSave=!0;!_.isUndefined(c.auto_draft)&&c.auto_draft&&(a=new d.Collections.Rows(a.builder_data),d.Instances.Builder[0]=new d.Views.Builder({el:"#themify_builder_row_wrapper",collection:a}),d.Instances.Builder[0].render());
b(b("#save-post").length?"#save-post":"#publish").trigger("click")}else alert(a.msg)}};if("pre-designed"==c.data("group")){ThemifyBuilderCommon.showLoader("show");var g="https://themify.me/themify-layouts/"+c.data("slug")+".txt";b.get(g,null,null,"text").done(function(a){e.data.builder_data=a;b.ajax(e)}).fail(function(a,b,c){ThemifyBuilderCommon.LiteLightbox.alert("There was an error in loading layout, please try again later, or you can download this file: ("+g+") and then import manually (http://themify.me/docs/builder#import-export).")}).always(function(){ThemifyBuilderCommon.showLoader()})}else b.ajax(e)},
{buttons:{no:{label:"Replace Existing Layout"},yes:{label:"Append Existing Layout"}}})},saveAsLayout:function(a){a.preventDefault();b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tfb_save_custom_layout",nonce:themifyBuilder.tfb_load_nonce,form_data:b("#tfb_save_layout_form").serialize()},success:function(a){"success"===a.status?ThemifyBuilderCommon.Lightbox.close():alert(a.msg)}})},applyAll_events:function(a){a=b(this);var c=a.closest(".themify_builder_field").prevUntil("h4");
if(a.prop("checked")){var e=!0;c.not(":last").slideUp(function(){e&&(c.last().find('input[type="text"], select').each(function(){var a="SELECT"===b(this).prop("tagName")?"change":"keyup";b(this).trigger(a)}),e=!1)});c.last().children(".themify_builder_input").css("color","#FFF")}else c.slideDown(),c.last().children(".themify_builder_input").css("color","")},importRowModBuilderFormSave:function(a){a.preventDefault();var c=b("#tfb_imp_component_form");a=c.find("input[name='component']").val();var e=
b('[data-cid="'+d.activeModel.cid+'"]').closest("[data-postid]");d.vent.trigger("dom:observer:start",e,{cid:d.activeModel.cid,value:d.activeModel.toJSON()});c=c.find("#tfb_imp_"+a.replace("-","_")+"_data_field");c=JSON.parse(c.val());if(c.hasOwnProperty("component_name")&&c.component_name===a){if("column"===a||"sub-column"===a){var f=b(".current_selected_column"),g=f.closest("column"===a?".themify_builder_row":".themify_builder_sub_row").index(),h=f.index();c.column_order=h;c.grid_class=f.prop("class").replace("themify_builder_col",
"");"column"===a?c.row_order=g:(c.sub_row_order=g,c.row_order=f.closest(".themify_builder_row").index(),c.col_order=f.parents(".themify_builder_col").index())}ThemifyBuilderCommon.Lightbox.close();d.activeModel.setData(c);d.vent.trigger("dom:builder:change");"visual"!==d.mode&&d.vent.trigger("dom:observer:end",e,{cid:d.activeModel.cid,value:d.activeModel.toJSON()})}else ThemifyBuilderCommon.alertWrongPaste()},moduleActions:function(){b("body").on("change",".module-widget-select-field",function(){var a=
b(this).val(),c=b(this).find(":selected").data("idbase");b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"html",data:{action:"module_widget_get_form",tfb_load_nonce:themifyBuilder.tfb_load_nonce,load_class:a,id_base:c},success:function(a){a=b(a);b(".module-widget-form-placeholder").html(a);b("#themify_builder_lightbox_container").each(function(){b(this).find("#instance_widget").find("select").wrap('<div class="selectwrapper"></div>')});b(".selectwrapper").click(function(){b(this).toggleClass("clicked")})}})}).on("editing_module_option",
function(a,c){var e=b("#tfb_module_settings .tfb_lb_option.module-widget-select-field");if(0!==e.length){var d=e.val(),e=e.find(":selected").data("idbase");b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"html",data:{action:"module_widget_get_form",tfb_load_nonce:themifyBuilder.tfb_load_nonce,load_class:d,id_base:e,widget_instance:c.instance_widget},success:function(a){a=b(a);b(".module-widget-form-placeholder").html(a)}})}})},isValidate:function(a){if(0===a.find("[data-validation]").length)return!0;
var c=this,e={};a.find("[data-validation]").each(function(){var a=b(this),d=b(this).data("validation"),h="";a.is("select, input, textarea")&&(h=a.val());c.checkValidate(d,h)||(e[a.prop("id")]=a.data("error-msg"))});a.find(".tb_field_error").removeClass("tb_field_error").end().find(".tb_field_error_msg").remove();if(_.isEmpty(e))return!0;_.each(e,function(a,c){var e=b("#"+c);e.addClass("tb_field_error");b("<span/>",{"class":"tb_field_error_msg","data-error-key":c}).text(a).insertAfter(e)});return!1},
checkValidate:function(a,b){return d.Forms.get_validator(a)(b)}};d.Forms.register_validator=function(a,b){this.Validators[a]=b};d.Forms.get_validator=function(a){return this.Validators.hasOwnProperty(a)?this.Validators[a]:this.Validators.not_empty};d.Forms.register_validator("email",function(a){var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a=a.split(",");return b.map(a,function(a,b){return c.test(a)?
null:"1"}).length?!1:!0});d.Forms.register_validator("not_empty",function(a){return a&&""!==a.trim()?!0:!1});d.Views.Toolbar=Backbone.View.extend({events:{"click .tb_toolbar_add_modules":"toogle_module_panel","hover .tb_toolbar_add_modules":"toggle_module_panel_hover","click .add_module_btn":"add_module","click .js-themify-builder-undo-btn":"action_undo","click .js-themify-builder-redo-btn":"action_redo","click .themify_builder_import_file":"import_file","click .themify_builder_import_page":"import_page",
"click .themify_builder_import_post":"import_post","click .themify_builder_load_layout":"load_layout","click .themify_builder_save_layout":"save_layout","click .themify_builder_dup_link":"duplicate","click .themify_builder_load_revision":"load_revision","click .themify_builder_save_revision":"save_revision","click .tb_toolbar_save":"save","click .tb_toolbar_close_btn":"panel_close","keyup .tb_module_panel_search_text":"search","click .tb_module_panel_lock":"lock","click .tb_toolbar_revision_btn":"toggle_rev_dropdown",
"click .js--themify_builder_breakpoint_switcher":"breakpoint_switcher"},initialize:function(){var a=this,c=b("body"),e=b("html,body"),f="",g=wp.template("builder_module_item_draggable");_.each(_.sortBy(themifyBuilder.modules,"name"),function(a,b){f+=g({slug:a.slug,name:a.name})});this.$(".tb_module_panel_modules_wrap").html(f);this.$(".themify_builder_module").draggable({appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:".themify_module_holder",cursorAt:{top:10,left:40},drag:function(b,
d){d.helper.addClass("tb_module_dragging_helper").removeClass("themify_builder_module");a._hide_module_panel();c.hasClass("tb_module_on_dragging")||c.addClass("tb_module_on_dragging");e.hasClass("tb_preview_fullheight")||e.addClass("tb_preview_fullheight")},stop:function(a,b){c.hasClass("tb_module_on_dragging")&&c.removeClass("tb_module_on_dragging");e.hasClass("tb_preview_fullheight")&&e.removeClass("tb_preview_fullheight")}});0<document.getElementsByClassName("tb_toolbar_menu").length&&(ThemifyBuilderCommon.undoManager.instance.setCallback(this.undoManagerCallback.bind(this)),
this.updateUndoBtns(),d.vent.on("dom:observer:start",function(a,b){b=b||{};ThemifyBuilderCommon.undoManager.setStartValue(a[0].innerHTML);ThemifyBuilderCommon.undoManager.setStartData(b);"visual"===d.mode&&ThemifyBuilderCommon.undoManager.setStartStyleValue(d.styleSheet.getCSSText());console.log("dom:observer:start")}).on("dom:observer:end",function(a,b){b=b||{};var c=ThemifyBuilderCommon.undoManager.getStartValue(),e=ThemifyBuilderCommon.undoManager.getStartData(),f=a[0].innerHTML,h=null;"visual"===
d.mode&&(h={startValue:ThemifyBuilderCommon.undoManager.getStartStyleValue(),newValue:d.styleSheet.getCSSText()});c!==f&&(ThemifyBuilderCommon.undoManager.set(a,c,f,e,b,h),d.editing=!0,console.log("dom:observer:end"))}));c.on("builder_toggle_frontend",function(b,e){e&&a.is_locked?c.addClass("tb_module_panel_locked"):!e&&a.is_locked&&c.removeClass("tb_module_panel_locked")}).on("click",function(c){a.is_locked||"tb_toolbar"===c.target.id||b(c.target).closest("#tb_toolbar").length||b(c.target).hasClass("js-tb_empty_row_btn")||
a._hide_module_panel()});this.$(".tb_toolbar_save").on({focusout:function(){b(this).data("timer",setTimeout(function(){a.$(".tb_toolbar_revision_btn").removeClass("tb_toolbar_rev_hover")}.bind(this),300))},focusin:function(){clearTimeout(b(this).data("timer"))}});new SimpleBar(this.$(".tb_module_panel_modules_wrap")[0]);this.on("hide-distraction-panel",function(){this._hide_distraction_module_panel()}).on("show-distraction-panel",function(){this._show_distraction_module_panel()});this.$(".tb_export_link").prop("href",
this.$(".tb_export_link").prop("href").replace("data.post_ID",themifyBuilder.post_ID));"visual"===d.mode&&this._setupModulePanelState()},toogle_module_panel:function(a){a.preventDefault();b(a.currentTarget).hasClass("tb_disabled")||(this.is_locked&&(this.is_locked=!1,b(".tb_module_panel_lock").removeClass("tb_locked"),"visual"===d.mode&&b("body").removeClass("tb_module_panel_locked")),this.$("#tb_module_panel").toggleClass("tb_module_panel_show"))},toggle_module_panel_hover:function(a){a.stopPropagation();
b(a.currentTarget).hasClass("tb_disabled")||"mouseenter"===a.type&&this.$("#tb_module_panel").addClass("tb_module_panel_show")},add_module:function(a){a.preventDefault();this._hide_module_panel();a=d.Views.init_module({mod_name:b(a.currentTarget).closest(".themify_builder_module").data("module-slug")},d.Instances.Builder[0].type);var c=d.Instances.Builder[0].$el.find(".themify_builder_row:visible").first().find(".themify_module_holder").first(),c=a.view.render().$el.appendTo(c);b("html,body").animate({scrollTop:c.offset().top-
300},500);a.view.trigger("edit");a.view.trigger("custom:preview:init")},btnUndo:document.getElementsByClassName("js-themify-builder-undo-btn")[0],btnRedo:document.getElementsByClassName("js-themify-builder-redo-btn")[0],action_undo:function(a){a.preventDefault();a.currentTarget.classList.contains("tb_disabled")||(ThemifyBuilderCommon.undoManager.instance.undo(),this.updateUndoBtns(),this.undoUpdateCallback())},action_redo:function(a){a.preventDefault();a.currentTarget.classList.contains("tb_disabled")||
(ThemifyBuilderCommon.undoManager.instance.redo(),this.updateUndoBtns(),this.undoUpdateCallback())},updateUndoBtns:function(){ThemifyBuilderCommon.undoManager.instance.hasUndo()?this.btnUndo.classList.remove("tb_disabled"):this.btnUndo.classList.add("tb_disabled");ThemifyBuilderCommon.undoManager.instance.hasRedo()?this.btnRedo.classList.remove("tb_disabled"):this.btnRedo.classList.add("tb_disabled")},undoManagerCallback:function(){console.log("undo callback");this.updateUndoBtns();ThemifyBuilderCommon.undoManager.startValue=
null},undoUpdateCallback:function(){d.Utils.columnDrag(null,!1);b(".themify_builder_module_front_overlay").hide();b(".themify_builder_dropdown_front").removeAttr("style");b(".themify_builder_col").css({height:"",position:"",zIndex:""});b(".themify_grid_drag_placeholder,.themify_builder_sortable_helper").remove();b(".tb_module_dragging_helper").remove();"visual"===d.mode&&d.Utils.loadContentJs();d.vent.trigger("dom:builder:change");"visual"===d.mode&&d.Frontend.responsiveFrame.doSync()},import_file:function(a){a.preventDefault();
a={dataType:"html",data:{action:"builder_import_file"}};var b=this.builderImportPlupload;confirm(themifyBuilder.i18n.importFileConfirm)&&ThemifyBuilderCommon.Lightbox.open(a,b)},import_page:function(a){a.preventDefault();this.builderImport("page")},import_post:function(a){a.preventDefault();this.builderImport("post")},builderImport:function(a){ThemifyBuilderCommon.Lightbox.open({dataType:"html",data:{action:"builder_import",type:a}},null)},builderImportPlupload:function(){var a=b(".themify-builder-plupload-upload-uic");
if(0<a.length){var c=!1;a.each(function(){var a=b(this).attr("id").replace("themify-builder-plupload-upload-ui","");c=JSON.parse(JSON.stringify(themify_builder_plupload_init));c.browse_button=a+c.browse_button;c.container=a+c.container;c.drop_element=a+c.drop_element;c.file_data_name=a+c.file_data_name;c.multipart_params.imgid=a;c.multipart_params._ajax_nonce=themifyBuilder.tfb_load_nonce;c.multipart_params.topost=themifyBuilder.post_ID;a=new plupload.Uploader(c);a.bind("Init",function(a){});a.init();
a.bind("FilesAdded",function(a,b){a.refresh();a.start();ThemifyBuilderCommon.showLoader("show")});a.bind("Error",function(a,c){var e=b(".prompt-box .show-error");b(".prompt-box .show-login").hide();e.show();0<e.length&&e.html('<p class="prompt-error">'+c.message+"</p>");b(".overlay, .prompt-box").fadeIn(500)});a.bind("FileUploaded",function(a,c,e){a=JSON.parse(e.response);var d="200"!=e.status||a.error?"error":"done";b("#themify_builder_alert").removeClass("busy").addClass(d).delay(800).fadeOut(800,
function(){b(this).removeClass(d)});a.error?alert(a.error):b("#themify_builder_alert").promise().done(function(){ThemifyBuilderCommon.Lightbox.close();window.location.reload()})})})}},load_layout:function(a){a.preventDefault();var c=this;ThemifyBuilderCommon.Lightbox.open({dataType:"html",data:{action:"tfb_load_layout"}},function(){var a=b("#themify_builder_tabs_pre-designed"),d=b('<div class="themify-builder-alert busy"></div>').appendTo(a);b.getJSON("https://themify.me/themify-layouts/index.json").done(function(e){var d=
wp.template("themify-builder-layout-item"),f=[];a.append(d(e));c.layoutLayoutsList();a.find("li.layout_preview_list").each(function(){var a=b(this).data("category").split(",");b.each(a,function(a,c){""!==c&&-1===b.inArray(c,f)&&(f.push(c),b("#themify_builder_pre-designed-filter").append('<li><a href="#">'+c+"</a></li>"))})});b("#themify_builder_pre-designed-filter").show().find("a").click(function(e){e.preventDefault();b(this).hasClass("selected")||(b(this).hasClass("all")?a.find(".layout_preview_list").css("display",
"block"):(e=b(this).text(),a.find(".layout_preview_list").css("display","none").filter('[data-category*="'+e+'"]').css("display","block")),b(this).addClass("selected").parent().siblings().find("a").removeClass("selected"),c.layoutLayoutsList())});b("#themify_builder_layout_search").on("keyup",function(){var e=b(this).val();e?(0< !b("#themify_builder_pre-designed-filter a.all.selected").length&&b("#themify_builder_pre-designed-filter a.all").click(),a.find(".layout_preview_list").hide(),a.find(".layout_title:contains("+
e+")").each(function(){b(this).closest(".layout_preview_list").show()})):a.find(".layout_preview_list").css("display","block");c.layoutLayoutsList()});b("#themify_builder_load_template_form .themify_builder_tabs").on("tabsactivate",function(a,b){c.layoutLayoutsList()})}).fail(function(a,c,e){ThemifyBuilderCommon.LiteLightbox.alert(b("#themify_builder_load_layout_error").show().text())}).always(function(){d.fadeOut()})})},layoutLayoutsList:function(){b("#themify_builder_load_template_form .themify_builder_layout_lists").each(function(){b(".layout-column-break",
this).removeClass("layout-column-break");var a=0;b(".layout_preview_list:visible",this).each(function(){1==a++/4&&(b(this).addClass("layout-column-break"),a=1)}).filter(":eq(0)").addClass("layout-column-break")})},save_layout:function(a){a.preventDefault();ThemifyBuilderCommon.Lightbox.open({data:{action:"tfb_custom_layout_form",postid:themifyBuilder.post_ID}},function(){d.Utils.builderPlupload("normal")})},duplicate:function(a){a.preventDefault();confirm(themifyBuilder.i18n.confirm_on_duplicate_page)?
d.Utils.saveBuilder(!0).done(this.duplicatePageAjax):this.duplicatePageAjax()},duplicatePageAjax:function(){b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tfb_duplicate_page",tfb_load_nonce:themifyBuilder.tfb_load_nonce,tfb_post_id:themifyBuilder.post_ID,tfb_is_admin:"visual"===d.mode?0:1},beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){ThemifyBuilderCommon.showLoader("hide");a=a.new_url.replace(/\&amp;/g,"&");window.location.href=
a}})},load_revision:function(a){a.preventDefault();a.stopPropagation();ThemifyBuilderCommon.Lightbox.open({data:{action:"tfb_load_revision_lists",postid:themifyBuilder.post_ID,tfb_load_nonce:themifyBuilder.tfb_load_nonce}},function(){b(".themify_builder_options_tab li:first-child").addClass("current")})},save_revision:function(a){a.preventDefault();a.stopPropagation();ThemifyBuilderCommon._saveRevision()},save:function(a){a.preventDefault();d.Utils.saveBuilder(!0).fail(function(){alert(themifyBuilder.i18n.errorSaveBuilder)})},
panel_close:function(a){d.toggleFrontEdit(a)},search:function(a){(a=b(a.currentTarget).val())?(this.$(".themify_builder_module_outer").hide(),this.$(".module_name:contains("+a+")").each(function(){b(this).closest(".themify_builder_module_outer").show()})):this.$(".themify_builder_module_outer").show()},is_locked:!1,lock:function(a){a.preventDefault();this._set_panel_lock(!this.is_locked);b(a.currentTarget).toggleClass("tb_locked");this.$(".tb_toolbar_add_modules").toggleClass("tb_disabled");this._hide_module_panel();
"visual"===d.mode&&b("body").toggleClass("tb_module_panel_locked")},_set_panel_lock:function(a){this.is_locked=a;localStorage.setItem("tb_module_panel_locked",this.is_locked)},_setupModulePanelState:function(){var a=localStorage.getItem("tb_module_panel_locked");_.isNull(a)||"true"!==a||(this.$("#tb_module_panel").addClass("tb_module_panel_show"),this.$(".tb_module_panel_lock").addClass("tb_locked"),this.$(".tb_toolbar_add_modules").toggleClass("tb_disabled"),b("body").addClass("tb_module_panel_locked"),
this.is_locked=!0)},toggle_rev_dropdown:function(a){a.preventDefault();b(a.currentTarget).toggleClass("tb_toolbar_rev_hover");this.$(".tb_toolbar_save").focus()},breakpoint_switcher:function(a){a.preventDefault();var c=b(a.currentTarget),e="desktop";a=d.activeBreakPoint;c.hasClass("breakpoint-tablet")?e="tablet":c.hasClass("breakpoint-tablet-landscape")?e="tablet_landscape":c.hasClass("breakpoint-mobile")&&(e="mobile");if(a===e)return!1;"visual"===d.mode&&"desktop"===e&&b(".themify_builder_grid_"+
e+" .themify_builder_column_direction li.selected a").trigger("click");d.activeBreakPoint=e;c.addClass("tb_selected").parent().siblings().find("a").removeClass("tb_selected");"visual"!==d.mode?(c="tablet_landscape"===e?"tablet":e,b(".themify_builder_row_panel").removeClass(a+"-responsive-selected").addClass(e+"-responsive-selected").find('.grid_tabs a[href="#'+c+'"]').trigger("click")):(b("body").add(d.Frontend.responsiveFrame.$el.find("body")).removeClass("builder-active-breakpoint--desktop builder-active-breakpoint--tablet builder-active-breakpoint--tablet_landscape builder-active-breakpoint--mobile").addClass("builder-active-breakpoint--"+
e).removeClass("tb_tablet tb_mobile tb_desktop").addClass("tb_"+e.replace("_landscape","")),"desktop"===e?(b(".themify_builder_site_canvas").animate({width:b(window).width()},800,function(){b(".themify_builder_workspace_container").removeClass("onshow")}),document.body.style.height="",document.body.style.paddingBottom="",this.$(".tb_toolbar_add_modules").removeClass("tb_disabled")):("desktop"===a&&d.Frontend.responsiveFrame.sync(),"mobile"!==e&&"mobile"!==a&&"desktop"!==a||d.Frontend.responsiveFrame.$el.find(".themify_builder_grid_"+
("tablet_landscape"===e?"tablet":e)+" .themify_builder_column_direction li.selected a").trigger("click"),d.Frontend.responsiveFrame.$el.find(".module_column").each(function(a,b){b.style.width&&(b.style.width="")}),b(".themify_builder_workspace_container").addClass("onshow"),b(".themify_builder_site_canvas").animate({width:d.Utils.getBPWidth(e)-1},800,function(){"mobile"!==e?d.Frontend.responsiveFrame.$el.find(".mobile-auto").removeClass("mobile-auto").addClass("tmp-mobile-auto"):d.Frontend.responsiveFrame.$el.find(".tmp-mobile-auto").removeClass("tmp-mobile-auto").addClass("mobile-auto");
setTimeout(function(){document.body.style.height=d.Frontend.responsiveFrame.contentWindow.document.body.scrollHeight+"px"},500);d.Frontend.responsiveFrame.contentWindow.scrollTo(0,b(window).scrollTop())}),this._disable_module_panel()),setTimeout(function(){var a=d.Frontend.responsiveFrame.$el.find("body");a.trigger("builderSwitchBreakpoint.themify",[a])},1E3))},_hide_module_panel:function(){this.is_locked||this.$("#tb_module_panel").hasClass("tb_module_panel_show")&&this.$("#tb_module_panel").removeClass("tb_module_panel_show")},
_show_module_panel:function(){this.is_locked||this.$("#tb_module_panel").hasClass("tb_module_panel_show")||this.$("#tb_module_panel").addClass("tb_module_panel_show")},_disable_module_panel:function(){this._set_panel_lock(!1);this.$(".tb_toolbar_add_modules").addClass("tb_disabled");this.$(".tb_module_panel_lock").removeClass("tb_locked");"visual"===d.mode&&b("body").removeClass("tb_module_panel_locked");this._hide_module_panel()},reopen_module_panel:!1,_hide_distraction_module_panel:function(){this.$("#tb_module_panel").hasClass("tb_module_panel_show")?
(this.$("#tb_module_panel").removeClass("tb_module_panel_show"),this.is_locked&&b("body").removeClass("tb_module_panel_locked"),this.reopen_module_panel=!0):this.reopen_module_panel=!1},_show_distraction_module_panel:function(){!this.$("#tb_module_panel").hasClass("tb_module_panel_show")&&this.reopen_module_panel&&(this.$("#tb_module_panel").addClass("tb_module_panel_show"),this.is_locked&&b("body").addClass("tb_module_panel_locked"),this.reopen_module_panel=!1)}});d.Views.bindEvents=function(){ThemifyBuilderCommon.setupLoader();
ThemifyBuilderCommon.Lightbox.setup();ThemifyBuilderCommon.LiteLightbox.modal.on("attach",function(){this.$el.addClass("themify_builder_lite_lightbox_modal")});d.Utils.setupTooltips();d.Utils.mediaUploader();d.Utils.openGallery()};d.Utils={clearClass:"col6-1 col5-1 col4-1 col4-2 col4-3 col3-1 col3-2 col2-1 col-full",gridClass:"col-full col4-1 col4-2 col4-3 col3-1 col3-2 col6-1 col5-1".split(" "),tfb_hidden_editor_object:null,_addNewColumn:function(a,b){var c=d.Views.init_column({grid_class:a.newclass,
component_name:a.component},a.type);b.append(c.view.render().$el)},removeGridClass:function(a,b){b=b.split(",");for(var c=a.prop("class").replace(/ +(?= )/g,"").split(" "),d=0;d<c.length;d++)for(var g=0;g<b.length;g++)-1!==c[d].indexOf(b[g])&&-1===c[d].indexOf("col-direction")&&a.removeClass(c[d])},removeEmptyFields:function(a){return a},hideResponsiveCols:function(a,c){if(c){c=parseInt(c);var e=0===c%2;a.hide().each(function(){var a=parseInt(b(this).children("a").data("col"));a===c||1===a||e&&0===
c%a?b(this).show():!e&&c>a&&(5===c&&(2===a||3===a)||3===c&&2===a)&&b(this).show()});var d=a.first().closest(".themify_builder_grid_list_wrapper").find(".themify_builder_column_direction");1===c?d.hide():d.show()}},filterClass:function(a){var c=this.gridClass.concat(["first","last"]);a=a.split(" ");for(var e=[],d=0;d<a.length;d++)-1<b.inArray(a[d],c)&&e.push(a[d]);return e.join(" ")},_getRowSettings:function(a,c){var e=this,f={},g={};a.find(".themify_builder_row_content").children(".themify_builder_col").each(function(a){var c=
e.filterClass(b(this).attr("class")),f={};b(this).find(".themify_module_holder").first().children().each(function(a){if(b(this).hasClass("active_module")){var c=b(this).data("cid"),c=d.Models.Registry.lookup(c);f[a]={mod_name:c.get("mod_name"),mod_settings:c.get("mod_settings")}}b(this).hasClass("themify_builder_sub_row")&&(f[a]=e._getSubRowSettings(b(this),a))});g[a]={column_order:a,grid_class:c,modules:f};b(this).prop("style").width&&(g[a].grid_width=parseFloat(b(this).prop("style").width));0<b(this).children(".column-data-styling").length&&
(c=b.parseJSON(b(this).children(".column-data-styling").attr("data-styling")),"object"===typeof c&&(g[a].styling=c))});f={row_order:c,cols:g};"gutter-default"!==a.data("gutter")&&(f.gutter=a.data("gutter"));"col_align_top"!==a.data("column-alignment")&&(f.column_alignment=a.data("column-alignment"));"ltr"!==a.data("desktop_dir")&&(f.desktop_dir=a.data("desktop_dir"));"ltr"!==a.data("tablet_dir")&&(f.tablet_dir=a.data("tablet_dir"));"ltr"!==a.data("mobile_dir")&&(f.mobile_dir=a.data("mobile_dir"));
"tablet-auto"!==b.trim(a.data("tablet"))&&(f.col_tablet=b.trim(a.data("tablet")));"mobile-auto"!==b.trim(a.data("mobile"))&&(f.col_mobile=b.trim(a.data("mobile")));if(0<a.find(".row-data-styling").length){var h=b.parseJSON(a.find(".row-data-styling").attr("data-styling"));"object"===typeof h&&(f.styling=h)}return f},_getSubRowSettings:function(a,c){var e=this,f={},g={};a.find(".themify_builder_col").each(function(a){var c=e.filterClass(b(this).attr("class")),f={};b(this).find(".active_module").each(function(a){var c=
b(this).data("cid"),c=d.Models.Registry.lookup(c);f[a]={mod_name:c.get("mod_name"),mod_settings:c.get("mod_settings")}});g[a]={column_order:a,grid_class:c,modules:f};b(this).prop("style").width&&(g[a].grid_width=parseFloat(b(this).prop("style").width));0<b(this).children(".column-data-styling").length&&(c=b.parseJSON(b(this).children(".column-data-styling").attr("data-styling")),"object"===typeof c&&(g[a].styling=c))});f={row_order:c,cols:g};"gutter-default"!==a.data("gutter")&&(f.gutter=a.data("gutter"));
"col_align_top"!==a.data("column-alignment")&&(f.column_alignment=a.data("column-alignment"));"ltr"!==a.data("desktop_dir")&&(f.desktop_dir=a.data("desktop_dir"));"ltr"!==a.data("tablet_dir")&&(f.tablet_dir=a.data("tablet_dir"));"ltr"!==a.data("mobile_dir")&&(f.mobile_dir=a.data("mobile_dir"));"tablet-auto"!==b.trim(a.data("tablet"))&&(f.col_tablet=b.trim(a.data("tablet")));"mobile-auto"!==b.trim(a.data("mobile"))&&(f.col_mobile=b.trim(a.data("mobile")));if(0<a.find(".subrow-data-styling").length){var h=
b.parseJSON(a.find(".subrow-data-styling").attr("data-styling"));"object"===typeof h&&(f.styling=h)}return f},builderPlupload:function(a){a=b(".themify-builder-plupload-upload-uic"+("new_elemn"===a?".plupload-clone":""));if(0<a.length){var c=!1;a.each(function(){var a=b(this),d=a.attr("id").replace("themify-builder-plupload-upload-ui","");c=JSON.parse(JSON.stringify(themify_builder_plupload_init));c.browse_button=d+c.browse_button;c.container=d+c.container;c.drop_element=d+c.drop_element;c.file_data_name=
d+c.file_data_name;c.multipart_params.imgid=d;c.multipart_params._ajax_nonce=themifyBuilder.tfb_load_nonce;c.multipart_params.topost=themifyBuilder.post_ID;a.data("extensions")&&(c.filters[0].extensions=a.data("extensions"));d=new plupload.Uploader(c);d.bind("Init",function(a){});d.init();d.bind("FilesAdded",function(a,c){a.refresh();a.start();b("#themify_builder_alert").addClass("busy").show()});d.bind("Error",function(a,c){var e=b(".prompt-box .show-error");b(".prompt-box .show-login").hide();e.show();
0<e.length&&e.html('<p class="prompt-error">'+c.message+"</p>");b(".overlay, .prompt-box").fadeIn(500)});d.bind("FileUploaded",function(c,e,d){c=JSON.parse(d.response);var f="200"!=d.status||c.error?"error":"done";b("#themify_builder_alert").removeClass("busy").addClass(f).delay(800).fadeOut(800,function(){b(this).removeClass(f)});c.error?alert(c.error):(d=c.large_url?c.large_url:c.url,e=c.id,c=c.thumb,a.closest(".themify_builder_input").find(".themify-builder-uploader-input").val(d).trigger("change").parent().find(".img-placeholder").empty().html(b("<img/>",
{src:c,width:50,height:50})).parent().show(),a.closest(".themify_builder_input").find(".themify-builder-uploader-input-attach-id").val(e))});a.removeClass("plupload-clone")})}},columnDrag:function(a,c,e,f){c&&(a?a.children(".themify_builder_col").css("width",""):b(".themify_builder_col").css("width",""));var g=this;c=a?a.children(".themify_builder_col").find(".themify_grid_drag"):b(".themify_grid_drag");var h=c.first().closest("[data-postid]"),k={"col6-1":14,"col5-1":17.44,"col4-1":22.6,"col4-2":48.4,
"col2-1":48.4,"col4-3":74.2,"col3-1":31.2,"col3-2":65.6},l={"col6-1":15.33,"col5-1":18.72,"col4-1":23.8,"col4-2":49.2,"col2-1":49.2,"col4-3":74.539,"col3-1":32.266,"col3-2":66.05},r={"col6-1":16.666,"col5-1":20,"col4-1":25,"col4-2":50,"col2-1":50,"col4-3":75,"col3-1":33.333,"col3-2":66.666};if(e&&f){a=a.children(".themify_builder_col");var q=("gutter-narrow"===e?1.6:"gutter-none"===e?0:3.2)-("gutter-narrow"===f?1.6:"gutter-none"===f?0:3.2),q=parseFloat(q*(a.length-1)/a.length);a.each(function(a){b(this).prop("style").width&&
(a=parseFloat(b(this).prop("style").width)+q,b(this).css("width",a+"%"))})}else c.each(function(){var a=b(this),c=a.closest(".themify_builder_sub_row_content"),c=0===c.length?a.closest(".themify_builder_row_content"):c,e=c.children(".themify_builder_col"),f=a.closest(".themify_builder_col"),q=0,n=a.hasClass("themify_drag_right")?"w":"e",t=!1,A=0,B="w"===n?"themify_grid_drag_placeholder_right":"themify_grid_drag_placeholder_left",y,z,C,n=a.hasClass("themify_drag_right")?"w":"e";a.draggable({axis:"x",
cursor:"col-resize",distance:0,containment:".themify_builder_row_content",helper:function(a){return b('<div class="ui-widget-header themify_grid_drag_placeholder '+B+'"></div><div class="ui-widget-header themify_grid_drag_placeholder"></div>')},start:function(b,e){d.vent.trigger("dom:observer:start",h);z="rtl"===c.closest("[data-cid]").data(d.activeBreakPoint+"_dir");"w"===n?(t=z?f.prev(".themify_builder_col"):f.next(".themify_builder_col"),q=a.outerWidth()):(t=z?f.next(".themify_builder_col"):f.prev(".themify_builder_col"),
q=f.outerWidth());A=t.outerWidth()-2;C=e.position.left;y=c.outerWidth()},stop:function(a,q){b(".themify_grid_drag_placeholder").remove();d.vent.trigger("dom:observer:end",h);var m=Math.ceil(100*(f.outerWidth()/y));f.css("width",m+"%");var p=k,m=3.2;c.hasClass("gutter-narrow")?(p=l,m=1.6):c.hasClass("gutter-none")&&(p=r,m=0);var n=m*(e.length-1);e.each(function(a){a!==t.index()&&(b(this).prop("style").width?a=parseFloat(b(this).prop("style").width):(a=b.trim(g.filterClass(b(this).attr("class")).replace("first",
"").replace("last","")),a=p[a]),n+=a)});t.css("width",100-n+"%")},drag:function(a,b){if(t&&0<t.length){var c=q+("e"===n?-b.position.left:b.position.left),e=parseFloat(100*c/y);if(5<=e&&100>e){var d=A+C+("w"===n?-b.position.left:b.position.left),h=parseFloat(100*d/y);5<h&&100>h&&(t.css("width",d+"px"),f.css("width",c+"px").children("."+B).html(e.toFixed(2)+"%"),f.children(".themify_grid_drag_placeholder").last().html(h.toFixed(2)+"%"))}}}})})},initNewEditor:function(a){if("undefined"!==typeof tinyMCEPreInit.mceInit[a])return this.initMCEv4(a,
tinyMCEPreInit.mceInit[a]);var b=this.tfb_hidden_editor_object;b.elements=a;b.selector="#"+a;b.wp_autoresize_on=!1;tinyMCEPreInit.mceInit[a]=b;return this.initMCEv4(a,tinyMCEPreInit.mceInit[a])},initMCEv4:function(a,b){if(3<parseInt(tinyMCE.majorVersion)){var c=new tinyMCE.Editor(a,b,tinyMCE.EditorManager);c.render();return c}},initQuickTags:function(a){"function"===typeof QTags&&(quicktags({id:a}),QTags._buttonsInit())},setColorPicker:function(a){b(".builderColorSelectInput",a).each(function(){if(b(this).data("control-type"))return!0;
d.Views.init_control("color",{el:b(this)})})},_getColClass:function(a){for(var c=this.clearClass.split(" "),e=null,d=0;d<a.length;d++)-1<b.inArray(a[d],c)&&(e=a[d].replace("col",""));return e},saveBuilder:function(a,c,e){e=e||"main";var f=_.map(d.Instances.Builder,function(a,b){var c=a.$el.data("postid")||null,e=a.toJSON()||null;return{id:c,data:e}});console.log(f,"ids");return b.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tfb_save_data",tfb_load_nonce:themifyBuilder.tfb_load_nonce,
ids:JSON.stringify(f),tfb_saveto:e},cache:!1,beforeSend:function(b){a&&ThemifyBuilderCommon.showLoader("show")},success:function(e){a&&ThemifyBuilderCommon.showLoader("hide");b.isFunction(c)&&c.call(this,e);d.editing=!1;b("body").trigger("themify_builder_save_data")},error:function(){a&&ThemifyBuilderCommon.showLoader("error")}})},loadContentJs:function(a){"undefined"!==typeof ThemifyBuilderModuleJs&&ThemifyBuilderModuleJs.loadOnAjax(a);b("body").trigger("builder_load_on_ajax")},setupTooltips:function(){(function(){b("body").on("mouseover mouseout",
'[rel^="themify-tooltip-"]',function(a){"mouseover"===a.type?(a=b(this).data("title")?b(this).data("title"):b(this).prop("title"),b(this).append('<span class="themify_tooltip">'+a+"</span>")):b(this).children(".themify_tooltip").remove()})})();ThemifyBuilderCommon.setUpTooltip()},mediaUploader:function(){var a=b("body");a.on("click",".themify-builder-media-uploader",function(a){var c=b(this),d=c.closest(".themify_builder_input"),g=1===d.children("#background_image").length,d=1===d.children("#background_video").length,
h=wp.media.frames.file_frame=wp.media({title:c.data("uploader-title"),library:{type:c.data("library-type")?c.data("library-type"):"image"},button:{text:c.data("uploader-button-text")},multiple:!1});h.on("select",function(){var a=h.state().get("selection").first().toJSON();c.closest(".themify_builder_input").find(".themify-builder-uploader-input").val(a.url).trigger("change").parent().find(".img-placeholder").empty().html(b("<img/>",{src:a.url,width:50,height:50})).parent().show();c.closest(".themify_builder_input").find(".themify-builder-uploader-input-attach-id").val(a.id)});
if(g||d)0===b("#hide_attachment_display_settings").length&&b("body").append('<style id="hide_attachment_display_settings">.media-modal .attachment-display-settings { display:none }</style>'),h.on("close",function(a){b("#hide_attachment_display_settings").remove()});h.open();a.preventDefault()});a.on("click",".themify-builder-delete-thumb",function(a){b(this).prev().empty().parent().hide();b(this).closest(".themify_builder_input").find(".themify-builder-uploader-input").val("").trigger("change");a.preventDefault()});
a.on("click",".insert-media",function(a){window.wpActiveEditor=b(this).data("editor")})},openGallery:function(){var a=wp.media.gallery.shortcode,c=this,d;b("body").on("click",".tf-gallery-btn",function(e){var f=b(this).closest(".themify_builder_input").find(".tf-shortcode-input");d=wp.media.frames.file_frame=wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:!0,multiple:!0,selection:!1});wp.media.gallery.shortcode=function(b){var c=b.props.toJSON(),d=_.pick(c,
"orderby","order");b.gallery&&_.extend(d,b.gallery.toJSON());d.ids=b.pluck("id");c.uploadedTo&&(d.id=c.uploadedTo);d._orderbyRandom&&(d.orderby="rand");delete d._orderbyRandom;d.ids&&"post__in"===d.orderby&&delete d.orderby;_.each(wp.media.gallery.defaults,function(a,b){a===d[b]&&delete d[b]});b=new wp.shortcode({tag:"gallery",attrs:d,type:"single"});f.val(b.string()).trigger("change");wp.media.gallery.shortcode=a;return b};0===b("#hide_gallery_settings").length&&b("body").append('<style id="hide_gallery_settings">.media-modal .gallery-settings { display:none }</style>');
d.on("close",function(a){b("#hide_gallery_settings").remove()});d.on("update",function(a){var b=wp.media.gallery.shortcode(a).string().slice(1,-1);f.val("["+b+"]");c.setShortcodePreview(a.models,f)});0<b.trim(f.val()).length?(d=wp.media.gallery.edit(b.trim(f.val())),d.on("close",function(a){b("#hide_gallery_settings").remove()}),d.state("gallery-edit").on("update",function(a){var b=wp.media.gallery.shortcode(a).string().slice(1,-1);f.val("["+b+"]");c.setShortcodePreview(a.models,f)})):(d.open(),b(".media-menu").find(".media-menu-item").last().trigger("click"));
e.preventDefault()})},setShortcodePreview:function(a,b){var c=b.next(".themify_builder_shortcode_preview"),d="";0===c.length&&(b.after('<div class="themify_builder_shortcode_preview"></div>'),c=b.next(".themify_builder_shortcode_preview"));for(var g in a)var h=a[g].attributes,d=d+('<img src="'+(h.sizes.thumbnail?h.sizes.thumbnail.url:h.url)+'" width="50" height="50" />');c.html(d)},createGradientPicker:function(a,c){if("undefined"!==typeof b.fn.ThemifyGradient){var e=a.closest(".themify-gradient-field"),
f=null,g=!1,h={onChange:function(b,c,e){a.val(b);g&&"visual"===d.mode&&(b="cover_gradient-gradient"===a.prop("name"),c=d.liveStylingInstance.bindBackgroundGradient(a.data("id"),c,b),b&&c&&d.liveStylingInstance.addOrRemoveComponentOverlay(c,!0))}};h.gradient=c?c:a.attr("data-default-gradient")?a.attr("data-default-gradient"):[];a.prev().ThemifyGradient(h);f=a.prev().data("ThemifyGradient");e.find(".themify-clear-gradient").on("click",function(b){b.preventDefault();f.settings.gradient="0% rgba(255,255,255, 1)|100% rgba(255,255,255,1)";
f.update();a.val("").trigger("change");"cover_gradient-gradient"===a.prop("name")&&"visual"===d.mode&&d.liveStylingInstance.addOrRemoveComponentOverlay("")});var k=e.find(".themify-gradient-angle");e.find(".themify-gradient-type").on("change",function(){f.setType(b(this).val());var a=k.closest(".gradient-angle-knob"),c=e.find(".themify-radial-circle");"radial"===b(this).val()?(a.hide(),a.next("span").hide(),c.show()):(a.show(),a.next("span").show(),c.hide())}).trigger("change");e.find(".themify-radial-circle").on("change",
function(){f.setRadialCircle("circle"==b(this).val())}).trigger("change");k.on("change",function(){var a=parseInt(b(this).val());a||(a=0);f.setAngle(a)}).knob({change:function(a){f.setAngle(Math.round(a))}});k.trigger("change");k.removeAttr("style").focus(function(){b(this).parent().find("canvas").show()}).parent().addClass("gradient-angle-knob").hover(function(){b(this).addClass("gradient-angle-hover-state")},function(){b(this).removeClass("gradient-angle-hover-state")}).find("canvas").insertAfter(k);
b(document).bind("click",function(){k.parent().is(".gradient-angle-hover-state")||k.parent().find("canvas").hide("fast")});setTimeout(function(){g=!0;e.closest(".tf-image-gradient-field").find(".tf-option-checkbox-js:checked").trigger("change")},900)}},checkUnload:function(){b("body").hasClass("themify_builder_active")&&(window.onbeforeunload=function(){return ThemifyBuilderCommon.undoManager.instance.hasUndo()&&d.editing?themifyBuilder.i18n.confirm_on_unload:null})},getRepeaterValues:function(a){var c=
[];a.find(".tb_repeatable_field").each(function(){var a={};b(this).find(".tfb_lb_option_child").each(function(){var c=b(this).data("input-id");c||(c=b(this).attr("id"));if(b(this).hasClass("tf-radio-choice"))var d=0<b(this).find(":checked").length?b(this).find(":checked").val():"";else if(b(this).hasClass("themify-layout-icon"))c||(c=b(this).attr("id")),d=0<b(this).find(".selected").length?b(this).find(".selected").attr("id"):b(this).children().first().attr("id");else if(b(this).hasClass("themify-checkbox"))d=
[],b(this).find(":checked").each(function(a){d[a]=b(this).val()});else if(b(this).hasClass("tfb_lb_wp_editor")){var e=b(this).attr("id"),c=b(this).attr("name");d="undefined"===typeof tinyMCE||_.isNull(tinyMCE.get(e))?b(this).val():!1===tinyMCE.get(e).hidden?tinyMCE.get(e).getContent():switchEditors.wpautop(tinymce.DOM.get(e).value)}else d=b(this).val();d&&(a[c]=d)});c.push(a)});return c},toRGBA:function(a){a=a.split("_");var b=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;if("undefined"!==typeof a[0])return b=
b.exec(a[0]),a="undefined"!==typeof a[1]?a[1]:1,b?"rgba("+parseInt(b[1],16)+", "+parseInt(b[2],16)+", "+parseInt(b[3],16)+", "+a+")":""},getBPWidth:function(a){a=_.isArray(themifyBuilder.breakpoints[a])?themifyBuilder.breakpoints[a]:themifyBuilder.breakpoints[a].toString().split("-");return a[a.length-1]},shortcodeToHTML:function(a){var b=[],d=1;_.each(themifyBuilder.available_shortcodes.split("|"),function(c,e){a=wp.shortcode.replace(c,a,function(a){b.push({key:d,sc_render:a.string()});a='<span data-rendered-sc="'+
d+'">[loading shortcode...]</span>';d++;return a})});return{tags:b,content:a}}};_.extend(d.Views.BaseElement.prototype,d.Mixins.Common);_.extend(d.Views.Builder.prototype,d.Mixins.Builder);d.Views.ControlRegistry={items:{},register:function(a,b){this.items[a]=b},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,b){a.remove()});this.items={};console.log("destroy controls")}};d.Views.Controls["default"]=Backbone.View.extend({initialize:function(a){d.Views.ControlRegistry.register(this.$el.attr("id"),
this);a.binding_type&&(this.binding_type=a.binding_type)},preview_element:function(a,b,e){if(!_.isUndefined(this.binding_type)){var c=d.activeModel.getPreviewSettings();!_.isUndefined(e)&&e.length?c[e.prop("id")]=d.Utils.getRepeaterValues(e):c[a]=b;d.activeModel.set("temp_settings",c);"live"===this.binding_type?d.activeModel.trigger("custom:preview:live",c):"refresh"===this.binding_type&&d.activeModel.trigger("custom:preview:reload")}}});d.Views.Controls["default"].extend=function(a){var b=this,d=
Backbone.View.extend.apply(this,arguments);d.prototype.events=_.extend({},this.prototype.events,a.events);d.prototype.initialize=function(){_.isFunction(b.prototype.initialize)&&b.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};return d};d.Views.register_control=function(a,b){"default"!==a&&(this.Controls[a]=this.Controls["default"].extend(b))};d.Views.get_control=function(a){return this.control_exists(a)?this.Controls[a]:this.Controls["default"]};
d.Views.control_exists=function(a){return this.Controls.hasOwnProperty(a)};d.Views.init_control=function(a,b){b=b||{};"wp_editor"===a&&(b.el.hasClass("data_control_binding_refresh")&&(b.binding_type="refresh"),b.el.hasClass("data_control_binding_live")&&(b.binding_type="live"));var c=b.el.attr("data-input-id")?b.el.attr("data-input-id"):b.el.attr("id");return(c=this.ControlRegistry.lookup(c))?(c.setElement(b.el).render(),c):new (d.Views.get_control(a))(b)};d.vent.on("dom:observer:update",function(a){console.log("dom:observer:update");
a.find("[data-cid]").each(function(){var a=b(this).data("cid");(a=d.Models.Registry.lookup(a))&&a.trigger("custom:dom:update")});a.find(".themify_builder_ui_state_highlight").remove()});d.Views.register_control("wp_editor",{mceEditor:null,initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("id");d.Utils.initQuickTags(c);if("undefined"!==typeof tinyMCE){var e=_.isNull(this.mceEditor)?d.Utils.initNewEditor(c):this.mceEditor,f=b.grep(this.el.className.split(" "),function(a,
b){return 0===a.indexOf("data_control_repeater_")}).join(),g=b("#"+f.replace("data_control_repeater_","")),f=function(b){a.preview_element(c,this.getContent(),g)};_.isUndefined(this.binding_type)||(e.on("keyup change",f),b("#"+c).on("keyup change",function(){a.preview_element(c,this.value,g)}))}return this},reBind:function(){this.mceEditor=tinyMCE.get(this.$el.attr("id"));this.render()},resetEditor:function(){this.mceEditor=null}});d.Views.register_control("text",{initialize:function(){this.render()},
render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),f=b("#"+d),d=function(){a.preview_element(c,this.value,f)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,f)},1E3));this.$el.on("keyup",d);return this}});d.Views.register_control("textonchange",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?
this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),f=b("#"+d),d=function(){a.preview_element(c,this.value,f)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,f)},1E3));this.$el.on("change",d);return this}});d.Views.register_control("image",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),
d=this.$el.attr("data-control-repeater"),f=b("#"+d),d=function(){a.preview_element(c,this.value,f)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,f)},1E3));this.$el.on("change",d);return this}});d.Views.register_control("textarea",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),f=b("#"+
d),d=function(){a.preview_element(c,this.value,f)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,f)},1E3));this.$el.on("keyup",d);return this}});d.Views.register_control("icon",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),f=b("#"+d),d=function(){a.preview_element(c,this.value,f)};
_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,f)},1E3));this.$el.on("change",d);return this}});d.Views.register_control("query_category",{initialize:function(){this.render()},render:function(){var a=this,b=a.$el.attr("id"),d=a.$el.parent(),f=d.find(".query_category_single"),g=d.find(".query_category_multiple"),h;f.add(g).on("change",function(c){h=g.val()?g.val()+"|multiple":f.val()+"|single";a.preview_element(b,h)});return this}});
d.Views.register_control("select",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),f=b("#"+d);this.$el.on("change",function(){a.preview_element(c,this.value,f)});return this}});d.Views.register_control("layout",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),
e=this.$el.attr("data-control-repeater"),f=b("#"+e);this.$(".tfl-icon").on("click",function(e){e.preventDefault();b(this).addClass("selected").siblings().removeClass("selected");if(!_.isUndefined(a.binding_type)&&"visual"===d.mode)if(e=b(this).prop("id"),"live"===a.binding_type)if(_.isUndefined(a.$el.data("control-selector")))a.preview_element(c,e,f);else{var h=d.liveStylingInstance.$liveStyledElmt,g=d.activeModel.getPreviewSettings();g[c]=e;d.activeModel.set({temp_settings:g},{silent:!0});""!==a.$el.data("control-selector")&&
(h=d.liveStylingInstance.$liveStyledElmt.find(a.$el.data("control-selector")));g=d.liveStylingInstance.getStylingVal(c);"layout_feature"===c?(e="layout-"+e,g="layout-"+g):"columns"===c&&(e=c+"-"+e,g=c+"-"+g);console.log(e,g);h.removeClass(g).addClass(e);"layout_feature"===c?e=e.substr(7):"columns"===c&&(e=e.substr(8));d.liveStylingInstance.setStylingVal(c,e)}else a.preview_element(c,e,f)});return this}});d.Views.register_control("radio",{initialize:function(){this.render()},render:function(){var a=
this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),f=b("#"+d);this.$('input[type="radio"]').on("click",function(){a.preview_element(c,this.value,f)});return this}});d.Views.register_control("checkbox",{initialize:function(){this.render()},render:function(){var a=this,b=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id");this.$('input[type="checkbox"]').on("click",function(){if(!_.isUndefined(a.binding_type)){var c=
a.$('input[type="checkbox"]:checked').map(function(){return this.value}).get();a.preview_element(b,c.join("|"))}});return this}});d.Views.register_control("color",{is_typing:!1,initialize:function(){this.render()},render:function(){var a=this,c=this.$el.parent().find(".builderColorSelect"),d=this.$el,f=c.parent().parent().find(".colordisplay"),g="",h=1,k=c.parent().parent().find(".color_opacity");d.val()&&(h=d.val(),-1!==h.indexOf("_")?(h=h.split("_"),g=h[0],h=h[1]?h[1]:1):(g=h,h=1),f.val(g),k.val(h));
c.minicolors({opacity:1,textfield:!1,change:_.debounce(function(e,h){var g=b(this).parent().parent().find(".builderColorSelectInput");if(e){h&&"0.99"==h&&(h="1");var l=e.replace("#","")+"_"+h;g.val(l);_.isUndefined(a.binding_type)||a.preview_element(g.prop("id"),l,b("#"+d.attr("data-control-repeater")));a.is_typing||(f.val(e.replace("#","")),k.is(":focus")||k.val(h));a.applyAll_verifyBorderColor(g,l,e.replace("#",""),e.replace("#",""),"change");b("body").trigger("themify_builder_color_picker_change",
[g.attr("name"),c.minicolors("rgbaString")])}else _.isUndefined(a.binding_type)||a.preview_element(g.prop("id"),"",b("#"+d.attr("data-control-repeater")))},200)});c.minicolors("value",g);c.minicolors("opacity",h);f.on("blur keyup",function(c){var d=b(this),e="",f=d.parent().find(".builderColorSelect"),h=d.parent().find(".builderColorSelectInput");d.val()&&(e=d.val());a.is_typing="keyup"===c.type;d.val(e.replace("#",""));h.val(d.val().replace(/[abcdef0123456789]{3,6}/i,e.replace("#","")));"keyup"===
c.type?f.minicolors("value",e):f.minicolors("value","").minicolors("value",e);a.applyAll_verifyBorderColor(h,h.val(),d.val(),e,c.type)});k.on("blur keyup",function(c){var d=b(this),e="",f=d.parent().find(".builderColorSelect");d.val()&&(e=d.val());a.is_typing="keyup"===c.type;d.val(e);f.minicolors("opacity",e)})},applyAll_verifyBorderColor:function(a,c,e,f,g){var h=!1;a=b(a);if(-1!==a.prop("name").indexOf("border_top_color")){var k=a.closest(".themify_builder_field").nextAll(".themify_builder_field");
k.each(function(){h=b(this).find(".style_apply_all_border");if(0<h.length)return!1});if(h&&h.is(":checked")){var l=null;"keyup"!==g?b(".builderColorSelectInput",k).each(function(){var a=b(this).closest(".themify_builder_input");l=a.find(".builderColorSelect");b(this).val(c);a.children(".colordisplay").val(e);l.minicolors("value",f)}):l=a.closest(".themify_builder_input").find(".builderColorSelect");"visual"===d.mode&&d.liveStylingInstance.setApplyBorder(a.prop("name"),l.minicolors("rgbaString"),"color")}}}});
d.Views.register_control("repeater",{events:{"click .toggle_row":"toggleField","hover .row_menu":d.Views.BaseElement.prototype.actionMenuHover,"click .themify_builder_duplicate_row":"duplicateRowField","click .themify_builder_delete_row":"deleteRowField"},initialize:function(){this.render();this.on("duplicate delete",this.updateElement)},updateElement:function(){this.preview_element(this.$el.attr("id"),null,this.$el)},render:function(){var a=this,c=this.$el.attr("id"),e=!1;this.$el.sortable({items:".tb_repeatable_field",
handle:".tb_repeatable_field_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursor:"move",start:_.debounce(function(c,d){"undefined"!==typeof tinyMCE&&a.$el.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,a)})},400),stop:_.debounce(function(f,g){"undefined"!==typeof tinyMCE&&a.$el.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id");tinyMCE.execCommand("mceAddEditor",
!0,a);d.Views.ControlRegistry.lookup(a).reBind()});e&&(g.item.removeClass("collapsed").find(".tb_repeatable_field_content").show(),e=!1);a.preview_element(c,null,a.$el);a.$el.find(".themify_builder_ui_state_highlight").remove()},400),sort:function(b,c){a.$el.find(".themify_builder_ui_state_highlight").height(30)},beforeStart:function(b,c){c.item.hasClass("collapsed")||(c.item.addClass("collapsed").find(".tb_repeatable_field_content").hide(),e=!0,a.$el.sortable("refresh"))}});return this},toggleField:function(a){a.preventDefault();
b(a.currentTarget).parents(".tb_repeatable_field").toggleClass("collapsed").find(".tb_repeatable_field_content").slideToggle()},duplicateRowField:function(a){a.preventDefault();var c=this.$el,e=b(a.currentTarget).closest(".tb_repeatable_field");a=e.clone();var f=c.find(".tb_repeatable_field:visible").length+1,g=f+Math.floor(9*Math.random());a.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).parents(".wp-editor-wrap").parent(),e=d.cache.repeaterElements[c.attr("id")].find(".wp-editor-wrap").parent().clone(),
f=e.find(".tfb_lb_wp_editor").prop("id"),g=b(this).prop("id"),n=b(this).prop("name"),v=g+"_"+ThemifyBuilderCommon.randNumber(),e=e.html().replace(new RegExp(f,"g"),v),g="undefined"!==typeof tinyMCE?!1===tinyMCE.get(g).hidden?tinyMCE.get(g).getContent():switchEditors.wpautop(tinymce.DOM.get(g).value):b("#"+g).val();a.html(e).find(".tfb_lb_wp_editor").prop("name",n).val(g).addClass("newEditor")});a.find("textarea:not(.tfb_lb_wp_editor)").each(function(a){(a=e.find("textarea").eq(a).val())&&b(this).val(a)});
a.find(".themify-builder-radio-dnd").each(function(a){var c=b(this).attr("name");b(this).attr({name:c+"_"+f,id:c+"_"+f+"_"+a}).next("label").attr("for",c+"_"+f+"_"+a)});a.find(".themify-builder-plupload-upload-uic").each(function(a){b(this).attr("id","pluploader_"+f+g+a+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find('input[type="button"]').attr("id","pluploader_"+f+g+a+"themify-builder-plupload-browse-button")});a.find("select").each(function(a){a=e.find("select").eq(a).find("option:selected").val();
b(this).find('option[value="'+a+'"]').prop("selected",!0)});a.find(".builderColorSelectInput").each(function(){var a=b(this),c=a.clone(),d=a.closest(".themify_builder_field");a.prev().minicolors("destroy").removeAttr("maxlength");d.find(".colordisplay").wrap('<div class="themify_builder_input" />').before('<span class="builderColorSelect"><span></span></span>').after(c)});a.find(".tfb_lb_option_child").each(function(){b(this).data("control-binding")&&b(this).data("control-type")&&d.Views.init_control(b(this).data("control-type"),
{el:b(this),binding_type:b(this).data("control-binding")})});a.insertAfter(e).find(".themify_builder_dropdown").hide();b("#tfb_module_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child.newEditor").each(function(a){d.Views.init_control("wp_editor",{el:b(this)});b(this).removeClass("newEditor")});d.Utils.builderPlupload("new_elemn");this.trigger("duplicate")},deleteRowField:function(a){a.preventDefault();confirm(themifyBuilder.i18n.rowDeleteConfirm)&&(a=b(a.currentTarget).closest(".tb_repeatable_field"),
1<a.closest(".themify_builder_row_js_wrapper").find(".tb_repeatable_field:visible").length?a.remove():a.hide(),this.trigger("delete"))}});d.Views.register_control("widget_select",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),f=b("#"+d);this.$el.on("change",function(){a.preview_element(c,this.value,f)});return this}});d.Views.register_control("widget_form",
{initialize:function(){this.render()},render:function(){this.this_option_id=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id");this.$el.on("change",":input",this._updateWidgetPreview.bind(this));return this},_updateWidgetPreview:function(){var a=this.$el.find(":input").themifySerializeObject();this.preview_element(this.this_option_id,a)}})})(jQuery);
